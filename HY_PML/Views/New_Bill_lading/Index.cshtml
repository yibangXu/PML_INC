@{
	Layout = "~/Views/Shared/_Layout.cshtml";
}
<!DOCTYPE html>
<html lang="zh">
<head>
	<title>@ViewBag.Title</title>
	<meta charset="utf-8" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width" />
	<meta name="description" content="The description of my page" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link href="~/Content/easyui/themes/default/easyui.css" rel="stylesheet" />
	<link href="~/Content/easyui/themes/icon.css" rel="stylesheet" />
	<style>
		#gridbtn_caption {
			opacity: 1;
		}

			#gridbtn_caption .ui-icon {
				display: none;
			}

			#gridbtn_caption .ui-pg-button-text {
				font-size: 16px;
				color: black;
			}

		.warning-dialog {
			text-align: center;
			line-height: 90px;
			font-size: 12px;
		}

		#t_grid {
			height: 50px;
		}

		td {
			height: 25px;
		}

		.textbox-value {
			max-width: 700px
		}
	</style>
</head>
<body>
	<div style="background-color:#f6f6f6">
		<div id="toolbar_grid"></div>
		<div id="toolbar_subgrid">
			<table>
				<tr>
					<td>
						<a class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="if ($('#grid').jqGrid('getGridParam', 'selrow') === null)
		$.messager.alert('警告', '尚未選擇【提單資料】！', 'warning'); else  Add('Tab2')">新增</a>
						<a class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="if ($('#subgrid').jqGrid('getGridParam', 'selrow') === null)
		$.messager.alert('警告', '尚未選擇資料！', 'warning'); else
		unlockForm('Tab2')">修改</a>
						<a class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="if ($('#subgrid').jqGrid('getGridParam', 'selrow')===null)
				$.messager.alert('警告', '尚未選擇資料！', 'warning');else Delete('Tab2')">刪除</a>
					</td>
				</tr>
			</table>
		</div>
		<div id="toolbar_subgrid2">
			<table>
				<tr>
					<td>
						<a class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="if ($('#grid').jqGrid('getRowData', $('#grid').jqGrid('getGridParam', 'selrow')).IsDesp === 'false') openDetail3_win(); else $.messager.alert('警告', '已轉【正式調派】，無法編輯資料!', 'warning')">修改</a>
						<a class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="if ($('#grid').jqGrid('getRowData', $('#grid').jqGrid('getGridParam', 'selrow')).IsDesp === 'false') destroyDetail3_win();else $.messager.alert('警告', '已轉【正式調派】，無法刪除資料!', 'warning')">刪除</a>
						<a class="easyui-linkbutton" iconCls="icon-large-clipart" plain="true" onclick="if ($('#grid').jqGrid('getRowData', $('#grid').jqGrid('getGridParam', 'selrow')).IsDesp === 'false') newBatchDetail3();else $.messager.alert('警告', '已轉【正式調派】，無法新增資料!', 'warning')">多筆新增</a>
					</td>
				</tr>
			</table>
		</div>
		<div id="toolbar_subgrid6">
			<table>
				<tr>
					<td>
						<a class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="if ($('#grid').jqGrid('getGridParam', 'selrow') === null)
		$.messager.alert('警告', '尚未選擇【提單資料】！', 'warning'); else  Add('Tab6')">新增</a>
						<a class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="if ($('#subgrid6').jqGrid('getGridParam', 'selrow') === null)
		$.messager.alert('警告', '尚未選擇資料！', 'warning'); else
		unlockForm('Tab6')">修改</a>
						<a class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="if ($('#subgrid6').jqGrid('getGridParam', 'selrow')===null)
	$.messager.alert('警告', '尚未選擇資料！', 'warning'); else Delete('Tab6')">刪除</a>
					</td>
				</tr>
			</table>
		</div>
		<table id="grid"></table>
		<div id="typeTab" class="easyui-tabs">
			@{
				Html.RenderAction("_ElementInTab1");
			}
			@{
				Html.RenderAction("_ElementInTab2");
			}
			@{
				Html.RenderAction("_ElementInTab3");
			}
			@{
				Html.RenderAction("_ElementInTab4");
			}
			@{
				Html.RenderAction("_ElementInTab5");
			}
			@{
				Html.RenderAction("_ElementInTab6");
			}
			@{
				Html.RenderAction("_ElementInTab7");
			}
		</div>
		<div id="pager"></div>
		<div id="totalbar">
			@{
				Html.RenderAction("_ElementInTotalbar");
			}
		</div>
		<script>
			var printID = '';
			var IsLoadData = true;//用於判斷調度區域給值時是否觸發onchange
			var grid = $("#grid");
			var apiURL = "/New_Bill_Lading/";
			var model = [
				{
					name: "LadingNo", label: "提單號碼", search: false, key: true, hidden: true,
				},
				{
					name: "LadingNo_Type", label: "提單號碼", search: false,
				},
				{
					name: "SendCustNo", label: "寄件客戶", search: false, hidden: true,
				},
				{
					name: "SendCHName", label: "寄件客戶", search: false,
				},
				{
					name: "HubNo", label: "路線", hidden: true,
				},
				{
					name: "HubName", label: "路線", search: false,
				},
				{
					name: "CName", label: "目的地", hidden: true,
				},
				{
					name: "CcNo", label: "付款方式", hidden: true,
				},
				{
					name: "IsDesp", label: "調派是否為正式", hidden: true,
				},
				{
					name: "ShdetNo", label: "ShdetNo", hidden: true,
				},
				{
					name: "Type", label: "貨物類型", hidden: true,
				},
				{
					name: "CocustomTyp", label: "報關類型", hidden: true,
				},
				{
					name: "IsFinance", label: "已轉會計", hidden: true,
				},
				{
					name: "ImOrEx", label: "進/出口", hidden: true,
				},
				{
					name: "IsInLading", label: "內開提單", hidden: true,
				},
				{
					name: "Printed", label: "已列印", hidden: true,
				},
			];
			grid.jqGrid({
				url: apiURL + "GetSearchGridJSON" + "?start_date=" + getToday() + "&end_date=" + getToday(),
				datatype: "json",
				colModel: model,
				sortname: "LadingNo",
				sortorder: "asc",
				shrinkToFit: false,
				autowidth: true,
				pager: "#pager",
				pgbuttons: true,
				pginput: false,
				viewrecords: false,
				rowNum: 20,
				hidegrid: false,
				toolbar: [true, "top"],
				altRows: true,
				altclass: "ui-jz-altRow",
				beforeSelectRow: function (rowid) {
					var lastSelect = $('#grid').jqGrid("getGridParam", "selrow");
					if (lastSelect != undefined && lastSelect != rowid) {
						$("#grid").jqGrid('setRowData', lastSelect, false, {
							opacity: "1",
							"border-bottom": "1px #d7d7d7d7"
						});
					} else if (lastSelect == rowid) {
						$("#grid").jqGrid("resetSelection");
						$("#grid").jqGrid('setRowData', lastSelect, false, {
							opacity: "1",
							"border-bottom": "1px #d7d7d7d7"
						});
					}
				},
				onSelectRow: function (id) {
					ajaxLoading('載入中…');
					$('.fm1').form('clear');
					$('.fm2').form('clear');
					$('.fm3').form('clear');
					lockForm();
					$("#grid").jqGrid('setRowData', id, false, {
						opacity: "0.9",
						"border-bottom": "1px black"
					});
					var selrow = $("#grid").jqGrid('getRowData', id);
					$('#showSel').text("｜提單號碼：" + selrow.LadingNo_Type);
					if (selrow.LadingNo != "") {
						$.getJSON('/New_Bill_Lading/GetGridJSON/?LadingNo=' + selrow.LadingNo, function (data) {
							if (data.records > 0) {
								var row = data.rows[0];
								$('.fm').form('load', row);
								$('#IsInLading').combobox('setValue', selrow.IsInLading);
								//$('#fmTotalbar').form('load', row);
								$('#subgrid').jqGrid("setGridParam", {
									url: "/New_Bill_Lading/GetSDJSON?ShdetNo=" + selrow.ShdetNo,
									datatype: 'json',
								}).trigger('reloadGrid');
								//$('#subgrid2').jqGrid("setGridParam", {
								//	url: "/New_Bill_Lading/GetSPJSON?ShdetNo=★",
								//	datatype: 'json',
								//}).trigger('reloadGrid');
								$('#subgrid2').jqGrid("clearGridData")
								$('#subgrid3').jqGrid("setGridParam", {
									url: "/DeclCust_Main/GetGridJson?LadingNo=" + selrow.LadingNo,
									datatype: 'json',
								}).trigger('reloadGrid');
								subgrid3IsView = true;
								$('#subgrid4').jqGrid("setGridParam", {
									url: "/New_Bill_Lading/GetFileTableJSON?LadingNo=" + selrow.LadingNo,
									datatype: 'json',
								}).trigger('reloadGrid');
								$('#subgrid5').jqGrid("setGridParam", {
									url: "/Bill_Lading_View/GetGridJSON2?LadingNo=" + selrow.LadingNo,
									datatype: 'json',
								}).trigger('reloadGrid');
								$('#subgrid6').jqGrid("setGridParam", {
									url: "/New_Bill_Lading/GetRecordJSON?LadingNo=" + selrow.LadingNo,
									datatype: 'json',
								}).trigger('reloadGrid');
								$('#subgrid7').jqGrid("setGridParam", {
									url: "/New_Bill_Lading/GetTB_temp_Acc1GridJSON?PTNO=" + selrow.LadingNo,
									datatype: 'json',
								}).trigger('reloadGrid');
								$('#subgrid8').jqGrid("clearGridData")
								//setTimeout(function () {
								$("#fileLadingNo").val(selrow.LadingNo);
								ajaxLoadEnd();
								//}, 500);
							}
						});
					}
				},
				gridComplete: function () {
					var rows = $("#grid").getDataIDs();
					for (var i = 0; i < rows.length; i++) {
						var Printed = $("#grid").getCell(rows[i], "Printed");
						if (Printed === "true") {
							$("#grid").jqGrid('setRowData', rows[i], false, {
								background: '#99BBFF'
							});
							continue;
						}
					}
					if (printID != '') {
						$("#grid").jqGrid('setSelection', printID);
					}
				}
			}).viewOnlyPager().filterToolbar({ searchOnEnter: true });
			//$("#pager").find(".ui-pg-button").hide();
			$("#t_grid").css("height", "30px").append($('#toolbar_grid'));

			$(function () {
				$("#toolbar_grid")
					//.append('<input id="searchDateStart" class="easyui-datebox " style="width:90px" value="getToday()" >')
					//.append(' ～<input id = "searchDateEnd" class= "easyui-datebox " style = "width:90px" value="getToday()">')
					//.append('<br>')
					//.append('	<select  id="searchType" class="easyui-combobox" style="width:90px;display:none"><option value = "0" > 提單號碼</option >')
					//.append(' ：<input   id="searchParam"  class= "easyui-textbox" style="width:90px" >')
					//.append('　<label id="LadingTotal" style="width:200px;color:red; font-size :18px"></label>')
					.append('<a class="easyui-linkbutton" iconCls="icon-search" plain="true" onclick="Search()"></a>')
					.append('<label style="margin:0px"><span id="showSel"></span></label>');

				var w = $(window);
				var wWidth = (w.innerWidth() * 3 / 4) - 25;
				var wHeight = w.innerHeight() - $(".navbar").height() - $("#totalbar").height() - 5;
				$("#typeTab").tabs({
					width: wWidth,
					height: wHeight,
				});
				$("#dataTab").tabs({
					width: wWidth - 10,
					height: wHeight - 30,
				});
				$("#dataTab1").css({ "width": wWidth - 15, "height": wHeight - 30 })
				$("#dataTab2").css({ "width": wWidth - 15, "height": wHeight - 30 })
				$("#dataTab3").css({ "width": wWidth - 15, "height": wHeight - 30 })
				$(".dataTable").css("width", wWidth - 15);
			});

			var ResizeGrid = ResizeGrid || function () {
				var w = $(window);
				var wWidth = w.innerWidth() * 1 / 4 - 20;
				var wHeight = w.innerHeight() - $(".navbar").height() - $("#totalbar").height() - 100;
				grid.jqGrid("setGridWidth", wWidth);
				grid.jqGrid("setGridHeight", wHeight);
				$("#gbox_grid").css("float", "left");
				$("#subgrid").jqGrid("setGridWidth", (w.innerWidth() * 3 / 4 * 1 / 5));
				$("#subgrid").jqGrid("setGridHeight", wHeight * 3 / 5);
				$("#subgrid2").jqGrid("setGridWidth", (w.innerWidth() * 3 / 4 * 3 / 5) - 25);
				$("#subgrid2").jqGrid("setGridHeight", wHeight * 3 / 5);
				$("#subgrid8").jqGrid("setGridWidth", (w.innerWidth() * 3 / 4 * 1 / 5));
				$("#subgrid8").jqGrid("setGridHeight", wHeight * 3 / 5 + 30);
				$("#subgrid3").jqGrid("setGridWidth", (w.innerWidth() * 3 / 4) - 25);
				$("#subgrid3").jqGrid("setGridHeight", wHeight * 2 / 5 + 10);
				$("#subgrid4").jqGrid("setGridWidth", w.innerWidth() * 3 / 4 - 25);
				$("#subgrid4").jqGrid("setGridHeight", wHeight + 10);
				$("#subgrid5").jqGrid("setGridWidth", w.innerWidth() * 3 / 4 - 25);
				$("#subgrid5").jqGrid("setGridHeight", wHeight + 10);
				$("#subgrid6").jqGrid("setGridWidth", w.innerWidth() * 3 / 4 - 25);
				$("#subgrid6").jqGrid("setGridHeight", wHeight - 130);
				$("#subgrid7").jqGrid("setGridWidth", w.innerWidth() * 3 / 4 - 25);
				$("#subgrid7").jqGrid("setGridHeight", wHeight - 30);
				console.log("Default Resize Mode");
			};

			$(function () {
				$(window).resize(
					function () {
						$("body").css("padding-top", $(".navbar").height());
						ResizeGrid();
					}).trigger("resize");
				setTimeout(function () {
					$(window).trigger("resize");
					lockForm();
				}, 1000);

				$.ajax({
					type: "post",
					url: '/New_Bill_Lading/' + "GetSearchSumJson?" +
						"start_date=" + getToday() +
						"&end_date=" + getToday(),
					success: function (result) {
						$('#fmTotalbar').form('load', result.rows);
					}
				});
			});

			$("#grid,#subgrid3").toArray().forEach(function (g) {
				(function AddGridComplete(grid) {
					if (typeof ($(grid).jqGrid) === "undefined")
						setTimeout(AddGridComplete, 150, grid);
					else {
						var fn = $(grid).jqGrid("autoWidthColumns").jqGrid("getGridParam", "gridComplete");
						$(grid).jqGrid("setGridParam", {
							gridComplete: function () {
								var target = $(grid).parents(".ui-jqgrid").find(".ui-paging-info");
								//fix space at records field
								var recordsnum = target.text().replace(/ /g, "").replace("r", " r");
								target.text(recordsnum);
								//call original function
								typeof (fn) === "function" && fn();
							}
						});
					}
				})(g);
			});

			//When tabSelected reloadGrid for autoWidthColumns
			$('#typeTab').tabs({
				onSelect: function (title, index) {
					switch (index) {
						case 1:
							$('#subgrid').trigger('reloadGrid');
							break
						case 2:
							$('#subgrid3').trigger('reloadGrid');
							subgrid3IsView = true;
							break
						case 3:
							$('#subgrid4').trigger('reloadGrid');
							break
						case 4:
							$('#subgrid5').trigger('reloadGrid');
							break
						case 5:
							$('#subgrid6').trigger('reloadGrid');
							break
					}
				}
			})
		</script>
	</div>

	<input type="hidden" id="hidStatNo" value="@ViewBag.StatNo">

	<!--提單2.0開窗搜尋-->
	<div id="dlgSearch" class="easyui-dialog" style="display:none;width:850px;height:300px;padding:10px 20px"
		 closed="true" buttons="#dlgSearch-buttons" data-options="resizable:false,draggable:true">
		<form id="fmdlgSearch" method="post" novalidate>
			<table>
				<tr>
					<td><label>提單號碼：</label></td>
					<td>
						<div class="fitem">
							<input id="s_LadingNo_Type" class="easyui-textbox" style="width:auto">
						</div>
					</td>
					<td><label> 起始時間：</label></td>
					<td>
						<div class="fitem">
							<input id="searchDateStart" class="easyui-datebox " style="width:auto" value="getToday()">
						</div>
					</td>
					<td><label> 截止時間：</label></td>
					<td>
						<div class="fitem">
							<input id="searchDateEnd" class="easyui-datebox " style="width:auto" value="getToday()">
						</div>
					</td>
				</tr>
				<tr>
					<td><label>收貨：</label></td>
					<td>
						<div class="fitem">
							<select class="easyui-combobox" id="s_IsDesp" style="width:auto;display:none" data-options="panelHeight:'auto'">
								<option value="">請選擇</option>
								<option value="true">是</option>
								<option value="false">否</option>

							</select>
							<script type="text/javascript">
								var s_IsDesp = [
									{ val: '', text: '請選擇' },
									{ val: 'true', text: '是' },
									{ val: 'false', text: '否' },
								];
							</script>
						</div>
					</td>
					<td><label> 路線：</label></td>
					<td>
						<div class="fitem">
							<input name="s_HubNo" id="s_HubNo" type="hidden">
							<input name="s_HubName" id="s_HubName" class="easyui-textbox" style="width:auto" readonly>
							<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
							   onclick="ShowWinForPickUpjqGrid('fmdlgSearch','s_HubNo,s_HubName,','HubNo,HubName','@Url.Action("getSelectionjqGrid", "Hub")');"></a>
						</div>
					</td>
					<td><label> 外務員：</label></td>
					<td>
						<div class="fitem">
							<input name="s_SectorNo" id="s_SectorNo" type="hidden">
							<input name="s_SectorName" id="s_SectorName" class="easyui-textbox" style="width:auto" data-options="readonly:true">
							<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
							   onclick="ShowWinForPickUpjqGrid('fmdlgSearch','s_SectorName,s_SectorNo','SectorName,SectorNo','@Url.Action("getSelectionjqGrid", "Sector")');"></a>
						</div>
					</td>
				</tr>
				<tr>
					<td><label>客戶編號：</label></td>
					<td>
						<div class="fitem">
							<input id="s_SendCustNo" class="easyui-textbox" style="width:auto">
						</div>
					</td>
					<td><label> 客戶電話：</label></td>
					<td>
						<div class="fitem">
							<input id="s_SendPhone" class="easyui-textbox" style="width:auto">
						</div>
					</td>
					<td><label> 客戶統編：</label></td>
					<td>
						<div class="fitem">
							<input id="s_SendInvNo" class="easyui-textbox " style="width:auto">
						</div>
					</td>
				</tr>
				<tr>
					<td><label>寄件公司名：</label></td>
					<td>
						<div class="fitem">
							<input id="s_SendCompany" class="easyui-textbox" style="width:auto">
						</div>
					</td>
					<td><label> 派件公司名：</label></td>
					<td>
						<div class="fitem">
							<input id="s_RecCompany" class="easyui-textbox" style="width:auto">
						</div>
					</td>
					<td><label> 派件電話：</label></td>
					<td>
						<div class="fitem">
							<input id="s_RecPhone" class="easyui-textbox " style="width:auto">
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<label>寄件站點：</label>
					</td>
					<td>
						<div class="fitem">
							<input name="s_SStatNo" id="s_SStatNo" type="hidden">
							<input name="s_SStatName" id="s_SStatName" class=" easyui-textbox" style="width:auto" readonly>
							<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
							   onclick="ShowWinForPickUpjqGrid('fmdlgSearch','s_SStatNo,s_SStatName','StatNo,StatName','@Url.Action("getSelectionjqGrid", "Stat")');"></a>
						</div>
					</td>
					<td>
						<label> 派件站點：</label>
					</td>
					<td>
						<div class="fitem">
							<input name="s_AStatNo" id="s_AStatNo" type="hidden">
							<input name="s_AStatName" id="s_AStatName" class="easyui-textbox" style="width:auto" data-options="readonly:'true'">
							<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
							   onclick="ShowWinForPickUpjqGrid('fmdlgSearch','s_AStatNo,s_AStatName','StatNo,StatName','@Url.Action("getSelectionjqGrid", "Stat")');"></a>
						</div>
					</td>
					<td>
						<label> 調度區域：</label>
					</td>
					<td>
						<div class="fitem">
							<input name="s_PickUpAreaNo" id="s_PickUpAreaNo" class="easyui-textbox" style="width:auto">
							<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
							   onclick="ShowWinForPickUpjqGrid('fmdlgSearch','s_PickUpAreaNo','PickUpAreaNo','@Url.Action("getSelectionjqGrid", "PickUpArea")');"></a>
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<label>報關類型 </label>
					</td>
					<td>
						<div class="fitem">
							<select id="s_CocustomTyp" class="easyui-combobox" style="width:auto;display:none" data-options="panelHeight:'auto'">
								<option value="">請選擇</option>
								<option value="0">0.不報關</option>
								<option value="1">1.正式報關</option>
								<option value="2">2.簡易報關</option>
								<option value="3">3.正式報關+後段核銷</option>
								<option value="4">4.簡易報關+後段核銷</option>
								<option value="5">5.不報關+後段核銷</option>
								<option value="6">6.其他</option>
							</select>
							<script type="text/javascript">
								var CocustomTyp = [
									{ val: '', text: '請選擇' },
									{ val: '0', text: '0.不報關' },
									{ val: '1', text: '1.正式報關' },
									{ val: '2', text: '2.簡易報關' },
									{ val: '3', text: '3.正式報關+後段核銷' },
									{ val: '4', text: '4.簡易報關+後段核銷' },
									{ val: '5', text: '5.不報關+後段核銷' },
									{ val: '6', text: '6.其他' }
								];
							</script>
						</div>
					</td>
					<td>
						<label>收貨狀態 </label>
					</td>
					<td>
						<div class="fitem">
							<select id="s_IsFinish" class="easyui-combobox" style="width:auto;display:none" data-options="panelHeight:'auto'">
								<option value="">請選擇</option>
								<option value="true">完成</option>
								<option value="false">未完成</option>
							</select>
							<script type="text/javascript">
								var s_IsFinish = [
									{ val: '', text: '請選擇' },
									{ val: 'true', text: '完成' },
									{ val: 'fasle', text: '未完成' },
								];
							</script>
						</div>
					</td>
					<td>
						<label>問題件</label>
					</td>
					<td>
						<select class="easyui-combobox" id="s_RecordType" name="s_RecordType" style="width:auto;display:none" data-options="panelHeight:'auto'">
							<option value="">請選擇</option>
							<option value=1>問題</option>
							<option value=2>客訴</option>
							<option value=3>內部說明</option>
							<option value=4>帳務說明</option>
							<option value=5>貨物說明</option>
							<option value=6>其他說明</option>
						</select>
						<script type="text/javascript">
							var Type = [
								{ val: '', text: '請選擇' },
								{ val: 1, text: '問題' },
								{ val: 2, text: '客訴' },
								{ val: 3, text: '內部說明' },
								{ val: 4, text: '帳務說明' },
								{ val: 5, text: '貨物說明' },
								{ val: 6, text: '其他說明' },
							];
						</script>
					</td>
				</tr>
				<tr>
					<td>
						<label>建單人員：</label>
					</td>
					<td>
						@*<select class="easyui-combobox" id="s_User" name="s_User" style="width:auto;display:none" data-options="panelHeight:'auto'">
							</select>*@
						<input id="s_User" class="easyui-combobox">
					</td>
				</tr>
			</table>
		</form>
	</div>
	<div id="dlgSearch-buttons" style="display:none">
		<a href="javascript:void(0)" class="easyui-linkbutton c6" iconCls="icon-ok" onclick="doSearchTarget()" style="width:90px">搜尋</a>
		<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-clear" onclick="dlgClear()" style="width:120px;float:left">清除查詢資料</a>
		<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlgSearch').dialog('close')" style="width:90px">取消</a>
	</div>

	<!--選擇搜尋框-->
	<div id="win" class="easyui-window" title="My Window" style="width:850px;height:520px;display:none"
		 data-options="resizable:false,draggable:false,iconCls:'icon-search',modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false">
	</div>

	<!--收件人編輯框-->
	<div id="dlgConsin" class="easyui-dialog" style="display:none;width:900px;height:520px;padding:10px 20px"
		 closed="true" buttons="#dlgConsin-buttons" data-options="resizable:false,draggable:true">
		<form id="fmConsin" method="post" novalidate>
			<table>
				<tr>
					@*<td><label>收件編號:</label></td>
						<td>
							<div class="fitem">
								<input name="ConsinNo" id="ConsinNo" class="easyui-textbox" style="width:auto" required data-options="validType:'maxLength[10]'">
							</div>
						</td>*@
					<td><label>客戶代號:</label></td>
					<td colspan="3">
						<div class="fitem">
							<input name="CustNo" id="dcoCustNo" type="hidden">
							<input name="CustCName" id="dcoCustCName" class="easyui-textbox" readonly />
							@*<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
								onclick="ShowWinForPickUpjqGrid('fmConsin','dcoCustNo,dcoCustCName','ConsinCustNo,CustCName','@Url.Action("getSelectionjqGrid", "Cust")');"></a>*@
						</div>
					</td>
				</tr>
				<tr>
					<td><label>收件公司:</label></td>
					<td>
						<div class="fitem">
							<input name="ConsinComp" id="dcoConsinComp" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[60]'">
						</div>
					</td>
					<td><label>英文名稱1:</label></td>
					<td>
						<div class="fitem">
							<input name="Enconsin1" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[60]'">
						</div>
					</td>
				</tr>
				<tr>
					<td><label>英文名稱2:</label></td>
					<td>
						<div class="fitem">
							<input name="Enconsin2" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
					<td><label>英文地址1:</label></td>
					<td>
						<div class="fitem">
							<input name="Enaddr1" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
				</tr>
				<tr>
					<td><label>英文地址2:</label></td>
					<td>
						<div class="fitem">
							<input name="Enaddr2" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
					<td><label>英文地址3:</label></td>
					<td>
						<div class="fitem">
							<input name="Enaddr3" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[100]'">
						</div>
					</td>
				</tr>
				<tr>
					<td><label>城市:</label></td>
					<td>
						<div class="fitem">
							<input name="City" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
					<td><label>省/州:</label></td>
					<td>
						<div class="fitem">
							<input name="State" id="dcoState" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
				</tr>
				<tr>
					<td><label>國家:</label></td>
					<td>
						<div class="fitem">
							<input name="Country" id="dcoCountry" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
					<td><label>郵遞區號:</label></td>
					<td>
						<div class="fitem">
							<input name="Zip" id="dciZip" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
				</tr>
				<tr>
					<td><label>電話:</label></td>
					<td>
						<div class="fitem">
							<input name="Tel" id="dcoTel" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
					<td><label>手機:</label></td>
					<td>
						<div class="fitem">
							<input name="MPhone" id="dcoMPhone" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
				</tr>
				<tr>
					<td><label>收件人:</label></td>
					<td>
						<div class="fitem">
							<input name="Consinee" id="dcoConsinee" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
					<td><label>簡稱統編:</label></td>
					<td>
						<div class="fitem">
							<input name="UnifyNo" id="dcoUnifyNo" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
					@*<td><label>地址代碼:</label></td>
						<td>
							<div class="fitem">
								<input name="Code5" id="dcoCode5" class="easyui-textbox" style="width:auto">
								<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
								   onclick="ShowWinForPickUpGrid('dcoCode5','Code5','textbox','none','none','none','選擇地址代碼','@Url.Action("getSelectionGrid", "PostCode")');"></a>
							</div>
						</td>*@
				</tr>
				@*<tr>
						<td><label>段:</label></td>
						<td>
							<div class="fitem">
								<input name="Add_1" class="easyui-textbox" style="width:auto">
							</div>
						</td>
						<td><label>巷:</label></td>
						<td>
							<div class="fitem">
								<input name="Add_2" class="easyui-textbox" style="width:auto">
							</div>
						</td>
					</tr>
					<tr>
						<td><label>弄:</label></td>
						<td>
							<div class="fitem">
								<input name="Add_3" class="easyui-textbox" style="width:auto">
							</div>
						</td>
						<td><label>號:</label></td>
						<td>
							<div class="fitem">
								<input name="Add_4" class="easyui-textbox" style="width:auto">
							</div>
						</td>
					</tr>
					<tr>
						<td><label>樓:</label></td>
						<td>
							<div class="fitem">
								<input name="Add_5" class="easyui-textbox" style="width:auto">
							</div>
						</td>
						<td><label>其他:</label></td>
						<td>
							<div class="fitem">
								<input name="Add_6" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
							</div>
						</td>
					</tr>*@
				<tr>
					<td><label>地址:</label></td>
					<td colspan="3">
						<div class="fitem">
							<input name="Cnaddr" id="dcoCnaddr" class="easyui-textbox" style="width:400px">
						</div>
					</td>
				</tr>
			</table>
		</form>
	</div>
	<div id="dlgConsin-buttons" style="display:none">
		<a href="javascript:void(0)" class="easyui-linkbutton c6" iconCls="icon-ok" onclick="SaveConsin()" style="width:90px">存檔</a>
		<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlgConsin').dialog('close')" style="width:90px">取消</a>
	</div>

	<!--客戶編輯框-->
	<div id="dlgCust" class="easyui-dialog" style="display:none;width:800px;height:520px;padding:10px 20px"
		 closed="true" buttons="#dlgCust-buttons2" data-options="resizable:false,draggable:true">
		<form id="fmCust" method="post" novalidate>
			<table style="border-collapse:collapse; width: 100%" ;>
				<tr>
					<td>
						<label>客戶代號:</label>
					</td>
					<td>
						<div class="fitem">
							<input name="CustNo" id="dcuCustNo" class="easyui-textbox" style="width:auto">
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<label>取件名稱:</label>
					</td>
					<td colspan="5">
						<div class="fitem">
							<input name="CarryName" class="easyui-textbox" style="width:auto" required data-options="validType:'maxLength[100]'">
						</div>
					</td>
				</tr>
				<tr style="border-bottom: 2px solid RGB(166,203,240);">
					<td style="border: 2px solid RGB(166,203,240);">	<label>中文資料 </label>
					<td>
					<td colspan="5"></td>
				</tr>
				<tr style="border-left: 2px solid RGB(166,203,240);">
					<td>
						<label>郵政5碼:</label>
					</td>
					<td colspan="4">
						<div class="fitem">
							<input name="Code5" id="dcuCode5" class="easyui-textbox" style="width:70px">
							<input name="Code7" id="dcuCode7" class="easyui-textbox" style="width:70px">
							<input name="CustAddr" id="dcuCustAddrDtl" class="easyui-textbox" style="width:240px">
							@*<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
								onclick="ShowWinForPickUpGrid('CustAddrDtl','AdrressSimpleVer','textbox','Code5','Code5','textbox','選擇地址','@Url.Action("getSelectionGrid", "PostCode")');"></a>*@
							<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
							   onclick="ShowWinForPickUpGrid20('dcuCode5','Code5','textbox','dcuCustAddrDtl','AdrressSimpleVer','textbox','dcuCode7','Code7','textbox','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','選擇地址','@Url.Action("getSelectionGrid20", "PostCode")');"></a>
						</div>
					</td>
					<td style="border-right: 2px solid RGB(166,203,240);">
					<td>
				</tr>
				<tr style="border-left: 2px solid RGB(166,203,240);">
					<td>
						<label>段巷弄號樓 :</label>
					</td>
					<td colspan="4">
						<div class="fitem">
							<input name="Add_1" id="dcuadd1" class="easyui-textbox" style="width:30px">段
							<input name="Add_2" id="dcuadd2" class="easyui-textbox" style="width:30px">巷
							<input name="Add_3" id="dcuadd3" class="easyui-textbox" style="width:30px">弄
							<input name="Add_4" id="dcuadd4" class="easyui-textbox" style="width:30px">號
							<input name="Add_5" id="dcuadd5" class="easyui-textbox" style="width:30px">樓
							, 其他
							<input name="Add_6" id="dcuadd6" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[50]'">
						</div>
					</td>
					<td style="border-right: 2px solid RGB(166,203,240);">
					<td>
				</tr>
				<tr style="border-left: 2px solid RGB(166,203,240);">
					<td>
						<label>寄件人:</label>
					</td>
					<td>
						<div class="fitem">
							<input name="SendBy" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[60]'">
						</div>
					</td>
					<td>
						<label>統一編號:</label>
					</td>
					<td>
						<div class="fitem">
							<input name="InvNo" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
					<td>
						<label>郵政專號:</label>
					</td>
					<td style="border-right: 2px solid RGB(166,203,240);">
						<div class="fitem">
							<input name="PostDist" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[6]'">
						</div>
					</td>
				</tr>
				<tr style="border-left: 2px solid RGB(166,203,240);border-bottom: 2px solid RGB(166,203,240);">
					<td>
						<label>城市:</label>
					</td>
					<td>
						<div class="fitem">
							<input name="City" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
					<td>
						<label>省州:</label>
					</td>
					<td>
						<div class="fitem">
							<input name="State" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
					<td>
						<label>國家:</label>
					</td>
					<td style="border-right: 2px solid RGB(166,203,240);">
						<div class="fitem">
							<input name="Country" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
				</tr>
				<tr style="border-bottom: 2px solid RGB(166,203,240);">
					<td style="border: 2px solid RGB(166,203,240);">	<label>英文資料 </label>
					<td>
					<td colspan="5"></td>
				</tr>
				<tr style="border-left: 2px solid RGB(166,203,240);">
					<td>
						<label>英文地址1:</label>
					</td>
					<td colspan="5" style="border-right: 2px solid RGB(166,203,240);">
						<div class="fitem">
							<input name="CustENAddr1" class="easyui-textbox" style="width:100%" data-options="validType:'maxLength[150]'">
						</div>
					</td>
				</tr>
				<tr style="border-left: 2px solid RGB(166,203,240);">
					<td>
						<label>英文地址2:</label>
					</td>
					<td colspan="5" style="border-right: 2px solid RGB(166,203,240);">
						<div class="fitem">
							<input name="CustENAddr2" class="easyui-textbox" style="width:100%" data-options="validType:'maxLength[60]'">
						</div>
					</td>
				</tr>
				<tr style="border-left: 2px solid RGB(166,203,240);">
					<td>
						<label>寄件人:</label>
					</td>
					<td>
						<div class="fitem">
							<input name="ESendBy" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[60]'">
						</div>
					</td>
					<td>
						<label>統一編號:</label>
					</td>
					<td>
						<div class="fitem">
							<input name="EInvNo" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
					<td>
						<label>郵政專號:</label>
					</td>
					<td style="border-right: 2px solid RGB(166,203,240);">
						<div class="fitem">
							<input name="EPostDist" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[6]'">
						</div>
					</td>
				</tr>
				<tr style="border-left: 2px solid RGB(166,203,240);border-bottom: 2px solid RGB(166,203,240);">
					<td>
						<label>城市:</label>
					</td>
					<td>
						<div class="fitem">
							<input name="ECity" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
					<td>
						<label>省州:</label>
					</td>
					<td>
						<div class="fitem">
							<input name="EState" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
					<td>
						<label>國家:</label>
					</td>
					<td style="border-right: 2px solid RGB(166,203,240);">
						<div class="fitem">
							<input name="ECountry" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[30]'">
						</div>
					</td>
				</tr>
				<tr style="padding-top:5px">
					<td>
						<label>會計聯絡人:</label>
					</td>
					<td>
						<div class="fitem">
							<input name="CtcAcc" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[20]'">
						</div>
					</td>
					<td>
						<label>業務部聯絡人:</label>
					</td>
					<td>
						<div class="fitem">
							<input name="CtcSale" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[20]'">
						</div>
					</td>
					<td>
						<label>業務代表:</label>
					</td>
					<td>
						<div class="fitem">
							<input name="Account" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[15]'">
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<label>發票抬頭:</label>
					</td>
					<td>
						<div class="fitem">
							<input name="InvTitle" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[250]'">
						</div>
					</td>
					<td>
						<label>發票地址:</label>
					</td>
					<td>
						<div class="fitem">
							<input name="InvAddr" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[60]'">
						</div>
					</td>
					<td></td>
					<td></td>
				</tr>
				<tr>
					<td>
						<label>備註:</label>
					</td>
					<td colspan="5">
						<div class="fitem">
							<input name="Remark" class="easyui-textbox" multiline="true" style="width:100%;height:50px" data-options="validType:'maxLength[100]'">
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<label>取件地址:</label>
					</td>
					<td colspan="5">
						<div class="fitem">
							<input name="dcuCode5_C" id="Code5_C" class="easyui-textbox" style="width:70px">
							<input name="dcuCode7_C" id="Code7_C" class="easyui-textbox" style="width:70px">
							<input name="dcuCustAddr_C" id="CustAddrDtl_C" class="easyui-textbox" style="width:240px">
							@*<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
								onclick="ShowWinForPickUpGrid('CustAddrDtl','AdrressSimpleVer','textbox','Code5','Code5','textbox','選擇地址','@Url.Action("getSelectionGrid", "PostCode")');"></a>*@
							<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
							   onclick="ShowWinForPickUpGrid20('dcuCode5_C','Code5','textbox','dcuCustAddrDtl_C','AdrressSimpleVer','textbox','dcuCode7_C','Code7','textbox','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','選擇地址','@Url.Action("getSelectionGrid20", "PostCode")');"></a>
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<label>　　</label>
					</td>
					<td colspan="5">
						<div class="fitem">
							<input name="Add_1_C" id="dcuadd1_C" class="easyui-textbox" style="width:30px">段
							<input name="Add_2_C" id="dcuadd2_C" class="easyui-textbox" style="width:30px">巷
							<input name="Add_3_C" id="dcuadd3_C" class="easyui-textbox" style="width:30px">弄
							<input name="Add_4_C" id="dcuadd4_C" class="easyui-textbox" style="width:30px">號
							<input name="Add_5_C" id="dcuadd5_C" class="easyui-textbox" style="width:30px">樓
							, 其他
							<input name="Add_6_C" id="dcuadd6_C" class="easyui-textbox" style="width:auto" data-options="validType:'maxLength[50]'">
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<label>取件週期:</label>
					</td>
					<td colspan="5">
						<div class="fitem">
							<input name="RedyDayOfWeek_0" class="form-check-input" type="checkbox" value="true" id="defaultCheck0">
							<label class="form-check-label" for="defaultCheck0">
								星期日
							</label>
							<input name="RedyDayOfWeek_1" class="form-check-input" type="checkbox" value="true" id="defaultCheck1">
							<label class="form-check-label" for="defaultCheck1">
								星期一
							</label>
							<input name="RedyDayOfWeek_2" class="form-check-input" type="checkbox" value="true" id="defaultCheck2">
							<label class="form-check-label" for="defaultCheck2">
								星期二
							</label>
							<input name="RedyDayOfWeek_3" class="form-check-input" type="checkbox" value="true" id="defaultCheck3">
							<label class="form-check-label" for="defaultCheck3">
								星期三
							</label>
							<input name="RedyDayOfWeek_4" class="form-check-input" type="checkbox" value="true" id="defaultCheck4">
							<label class="form-check-label" for="defaultCheck4">
								星期四
							</label>
							<input name="RedyDayOfWeek_5" class="form-check-input" type="checkbox" value="true" id="defaultCheck5">
							<label class="form-check-label" for="defaultCheck5">
								星期五
							</label>
							<input name="RedyDayOfWeek_6" class="form-check-input" type="checkbox" value="true" id="defaultCheck6">
							<label class="form-check-label" for="defaultCheck6">
								星期六
							</label>
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<label>取件時間:</label>
					</td>
					<td>
						<div class="fitem">
							<input name="RedyTime" class="easyui-timespinner" style="width:auto" data-options="validType:'maxLength[5]'">
						</div>
					</td>
					<td>
						<label>是否啟用:</label>
					</td>
					<td>
						<div class="fitem">
							<input name="IsServer" id="IsServer" class="easyui-switchbutton" data-options="onText:'是',offText:'否',value:'true'">
						</div>
					</td>
					<td></td>
					<td></td>
				</tr>
			</table>
		</form>
	</div>
	<div id="dlgCust-buttons2" style="display:none">
		<a href="javascript:void(0)" class="easyui-linkbutton c6" iconCls="icon-ok" onclick="SaveCust()" style="width:90px">存檔</a>
		<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlgCust').dialog('close')" style="width:90px">取消</a>
	</div>

	<!--快速新增-->
	<div id="winQuickAdd" class="easyui-window" title="快速新增" style="width:800px;height:600px;display:none"
		 data-options="modal:true,resizable:false,draggable:true,closed:true,collapsible:false,minimizable:false,maximizable:false">
		<a class="easyui-linkbutton" iconCls="icon-ok" plain="true" onclick="if (checkTodaySameCust($('#CustNoQuickAdd').val())) { return false; };saveAllQuickAdd();">存檔</a>
		<form id="fmQuickAdd" method="post" novalidate>
			<table>
				<tr>
					<td style="vertical-align: top;">
						<table>
							<tr>
								<td><label>提單號碼</label></td>
								<td>
									<input name="LadingNo_Type" id="LadingNo_TypeQuickAdd" class="easyui-textbox" style="width:auto">
								</td>
							</tr>
							<tr>
								<td><label>客戶代號</label></td>
								<td>
									<input type="hidden" name="ShdetNo" id="ShdetNoQuickAdd">
									<input type="hidden" name="sNo" id="sNoQuickAdd">
									<input name="CustNo" id="CustNoQuickAdd" class="easyui-textbox" required style="display:none;width:90px" data-options="readonly:true">
									<a id="searchCustQuickAdd" class="easyui-linkbutton" data-options="iconCls:'icon-search'"
									   onclick="ShowWinForPickUpjqGrid('fmQuickAdd','CustCHName,CustNo','CustCHName,CustNo','@Url.Action("getSelectionjqGrid", "Cust")');"></a>
								</td>
								<td>
									<div class="form-check">
										<input name="newCust" class="form-check-input" value="true" type="checkbox" id="defaultCheckQuickAdd" onclick="isNewCust()">
										<label class="form-check-label" for="defaultCheckQuickAdd">
											不收款客戶
										</label>
									</div>
								</td>
							</tr>
							<tr>
								<td><label>客戶名稱</label></td>
								<td>
									<input name="CustCHName" id="CustCHNameQuickAdd" class="easyui-textbox" style="display:none;width:90px" required>
								</td>
							</tr>
							<tr id="newCustZoneTrQuickAdd" style="display:none">
								<td><label id="newCustZoneLabelQuickAdd" style="display:none">區碼(3碼)</label></td>
								<td>
									<div id="newCustZoneQuickAdd" style="display:none">
										<input name="Post3Code" id="Post3CodeQuickAdd" class="easyui-textbox" style="display:none;width:90px">
									</div>
								</td>
							</tr>
							<tr>
								<td><label>業務專員</label></td>
								<td>
									<select class="easyui-combobox" id="HeadClerkQuickAdd" name="Clerk" style="width:auto;" data-options="panelHeight:'auto'"></select>
								</td>
							</tr>
							<tr>
								<td><label>路線</label></td>
								<td>
									<div style="display:none;width:90px"><input name="HubNo" id="HubNoQuickAdd" class="easyui-textbox" style="display:none;width:90px"></div>
									<input name="HubName" id="HubNameQuickAdd" class="easyui-textbox" data-options="readonly:true" style="display:none;width:90px" required="true">
									<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
									   onclick="ShowWinForPickUpjqGrid('fmQuickAdd','HubName,HubNo','HubName,HubNo','@Url.Action("getSelectionjqGrid", "Hub")');"></a>
								</td>
							</tr>
							<tr>
								<td><label>目的地</label></td>
								<td>
									<input name="Dest" id="DestQuickAdd" class="easyui-textbox" style="display:none;width:90px">
									<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
									   onclick="ShowWinForPickUpjqGrid('fmQuickAdd','Dest','CName','@Url.Action("getSelectionjqGrid", "Dest")');"></a>
								</td>
							</tr>
							<tr>
								<td><label>預約日期</label></td>
								<td>
									<input name="ReserveDate" id="ReserveDateQuickAdd" class="easyui-datetimebox" style="display:none;width:150px" data-options="readonly:false">
								</td>
							</tr>
							<tr>
								<td><label>出貨日期</label></td>
								<td>
									<input name="SDate" id="SDateQuickAdd" class="easyui-datebox" style="display:none;width:150px" data-options="readonly:false">
								</td>
							</tr>
						</table>
					</td>
					<td style="vertical-align: top;">
						<table id="tableDetailQuickAdd">
							<tr>
								<td><label>取件名稱:</label></td>
								<td>
									<div class="fitem">
										<input name="CarryName" id="CarryNameQuickAdd" class="easyui-textbox" style="width:90px" required>
										<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
										   onclick="if($('#CustNoQuickAdd').val() == ''){ $.messager.alert('提示', '無客戶代號'); return false;} ShowWinForPickUpjqGrid('fmQuickAdd','CarryName,Code5,Code7,CustAddr,Add_1,Add_2,Add_3,Add_4,Add_5,Add_6,CustENAddr1,CtcSale,Tel,Country,CcNo,PickUpAreaNo','CarryName,Code5,Code7,CustAddr,Add_1,Add_2,Add_3,Add_4,Add_5,Add_6,CustENAddr1,CtcSale,Tel,Country,CcNo,PickUpAreaNo','@Url.Action("getSelectionjqGrid", "ShdetF")',$('#CustNoQuickAdd').val(),'GetGridJSON_HistoryShdetDetail');"></a>
									</div>
								</td>
							</tr>
							<tr>
								<td><label>郵政5碼:</label></td>
								<td colspan="3">
									<div class="fitem">
										<input name="Code5" id="Code5QuickAdd" class="easyui-textbox" style="width:70px;display:none" data-options="readonly:true">
										<input name="Code7" id="Code7QuickAdd" class="easyui-textbox" style="width:70px" data-options="readonly:true" required>
										<input name="CustAddr" id="CustAddrQuickAdd" class="easyui-textbox" style="width:240px" data-options="readonly:true,onChange:function(newValue,oldValue){ CustAddrChangedQuickAdd(newValue,oldValue);}" required>
										<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
										   onclick="ShowWinForPickUpGrid20('Code5QuickAdd','Code5','textbox','CustAddrQuickAdd','AdrressSimpleVer','textbox','PickUpAreaNoQuickAdd','PickUpAreaNo','textbox','Code7QuickAdd','Code7','textbox','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','none','選擇地址','@Url.Action("getSelectionGrid20", "PostCode")',$('#Code5QuickAdd').val());"></a>
									</div>
								</td>
							</tr>
							<tr>
								<td><label>段巷弄號樓 :</label></td>
								<td colspan="3">
									<div class="fitem">
										<input name="Add_1" id="add1QuickAdd" class="easyui-textbox" style="width:30px">段
										<input name="Add_2" id="add2QuickAdd" class="easyui-textbox" style="width:30px">巷
										<input name="Add_3" id="add3QuickAdd" class="easyui-textbox" style="width:30px">弄
										<input name="Add_4" id="add4QuickAdd" class="easyui-textbox" style="width:30px" required>號
										<input name="Add_5" id="add5QuickAdd" class="easyui-textbox" style="width:30px">樓
										,其他<input name="Add_6" id="add6QuickAdd" class="easyui-textbox" style="width:120px">
									</div>
								</td>
							</tr>
							<tr>
								<td><label>英文地址:</label></td>
								<td colspan="3">
									<div class="fitem">
										<input name="CustENAddr1" id="CustENAddr1QuickAdd" class="easyui-textbox" style="width:240px">
									</div>
								</td>
							</tr>
							<tr>
								<td><label>國家:</label></td>
								<td>
									<div class="fitem">
										<input name="Country" id="CountryQuickAdd" class="easyui-textbox" style="width:90px">
									</div>
								</td>
								<td><label>業務部聯絡人:</label></td>
								<td>
									<div class="fitem">
										<select class="easyui-combobox" id="CtcSaleQuickAdd" name="CtcSale" style="width:auto;" data-options="panelHeight:'auto'" required></select>
									</div>
								</td>
							</tr>
							<tr>
								<td><label>電話:</label></td>
								<td>
									<div class="fitem">
										<input name="Tel" id="TelQuickAdd" class="easyui-textbox" style="width:90px" required="true">
									</div>
								</td>
								<td><label>可取件日期</label></td>
								<td><input id="RedyDateQuickAdd" name="RedyDate" class="easyui-datebox" style="display:none;width:90px"></td>
							</tr>
							<tr>
								<td><label>可取件時間</label></td>
								<td><input id="RedyTimeQuickAdd" name="RedyTime" class="easyui-timespinner" style="display:none;width:80px" required="true"></td>
								<td><label>外務員:</label></td>
								<td>
									<div class="fitem">
										<input name="SectorName" id="SectorNameQuickAdd" class="easyui-textbox" style="width:90px" data-options="readonly:true" required>
										<input type="hidden" name="SectorNo" id="SectorNoQuickAdd" class="easyui-textbox" style="width:0px;display:none !important" data-options="readonly:true">
										<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
										   onclick="ShowWinForPickUpjqGrid('fmQuickAdd','SectorName,SectorNo,CarID,CallStatNo','SectorName,SectorNo,CarID,StatNo','@Url.Action("getSelectionjqGrid_Add", "Sector")');"></a>
									</div>
								</td>
							</tr>
							<tr>
								<td><label>調度區域:</label></td>
								<td>
									<div class="fitem">
										<input name="PickUpAreaNo" id="PickUpAreaNoQuickAdd" class="easyui-textbox" style="width:90px" required data-options="readonly:true,onChange:function(newValue,oldValue){ PickUpAreaNoChangedQuickAdd(newValue,oldValue);}">
										<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
										   onclick="ShowWinForPickUpjqGrid('fmQuickAdd','PickUpAreaNo','PickUpAreaNo','@Url.Action("getSelectionjqGrid", "PickUpArea")');"></a>
									</div>
								</td>
								<td><label>截止時間:</label></td>
								<td>
									<div class="fitem">

										<input name="EndDate" id="EndDateQuickAdd" class="easyui-timespinner" style="width:80px;"
											   data-options="showSeconds:false" required>
									</div>
								</td>
							</tr>
							<tr>
								<td><label>叫件站點:</label></td>
								<td>
									<div class="fitem">
										<input name="StatNo" id="StatNoQuickAdd" class="easyui-textbox" style="width:90px" data-options="readonly:true" value="@ViewBag.StatNo" required>
									</div>
								</td>
								<td><label>車輛ID:</label></td>
								<td>
									<input name="CarID" id="CarIDQuickAdd" class="easyui-textbox" style="width:90px" required readonly>
									<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
									   onclick="ShowWinForPickUpjqGrid('fmQuickAdd','CarID','CarID','@Url.Action("getSelectionjqGrid", "Vehicle")');"></a>
								</td>
							</tr>
							<tr>
								<td><label>貨物類型</label></td>
								<td>
									<select class="easyui-combobox" name="WeigLevel" style="width:auto;display:none">
										<option value="0">0.文件</option>
										<option value="1">1.包裹5KG以下</option>
										<option value="2">2.箱貨5KG以上</option>
										<option value="3">3.木箱</option>
										<option value="4">4.棧板</option>
									</select>
									<script type="text/javascript">
										var WeigLevel = [
											{ val: '0', text: '0.文件' },
											{ val: '1', text: '1.包裹5KG以下' },
											{ val: '2', text: '2.箱貨5KG以上' },
											{ val: '3', text: '3.木箱' },
											{ val: '4', text: '4.棧板' }
										];
									</script>
								</td>
								<td><label>報關類型</label></td>
								<td>
									<select class="easyui-combobox" name="CocustomTyp" style="width:auto;display:none">
										<option value="0">0.不報關</option>
										<option value="1">1.正式報關</option>
										<option value="2">2.簡易報關</option>
										<option value="3">3.正式報關+後段核銷</option>
										<option value="4">4.簡易報關+後段核銷</option>
										<option value="5">5.不報關+後段核銷</option>
										<option value="6">6.其他</option>
									</select>
									<script type="text/javascript">
										var CocustomTyp = [
											{ val: '0', text: '0.不報關' },
											{ val: '1', text: '1.正式報關' },
											{ val: '2', text: '2.簡易報關' },
											{ val: '3', text: '3.正式報關+後段核銷' },
											{ val: '4', text: '4.簡易報關+後段核銷' },
											{ val: '5', text: '5.不報關+後段核銷' },
											{ val: '6', text: '6.其他' }
										];
									</script>
								</td>
							</tr>
							<tr>
								<td><label>付款方式</label></td>
								<td>
									<input name="CcNo" id="CcNoQuickAdd" class="easyui-textbox" style="display:none;width:90px" data-options="readonly:true">
									<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
									   onclick="ShowWinForPickUpjqGrid('fmQuickAdd','CcNo','CcNo','@Url.Action("getSelectionjqGrid", "Cc")');"></a>
								</td>
								<td><label>收款金額</label></td>
								<td><input name="Charge" id="ChargeQuickAdd" class="easyui-textbox" style="display:none;width:90px"></td>
							</tr>
							<tr>
								<td><label>取件站點:</label></td>
								<td>
									<div class="fitem">
										<input name="CallStatNo" id="CallStatNoQuickAdd" class="easyui-textbox" value="@ViewBag.StatNo" style="width:90px" data-options="readonly:true" required>
										<a class="easyui-linkbutton" data-options="iconCls:'icon-search'"
										   onclick="ShowWinForPickUpjqGrid('fmQuickAdd','CallStatNo','StatNo','@Url.Action("getSelectionjqGrid", "Stat")');"></a>
									</div>
								</td>
								<td>
									<label>準時取件:</label>
								</td>
								<td>
									<div class="fitem">
										<input name="IsRedy" id="IsRedyQuickAdd" class="easyui-switchbutton" data-options="onText:'是',offText:'否',value:'true'">
									</div>
								</td>
							</tr>
							<tr style="display:none">
								<td><label>可取件日期</label></td>
								<td><input id="ADateQuickAdd" name="ADate" class="easyui-datebox" style="display:none;width:auto"></td>

								<td><label>可取件時間</label></td>
								<td><input id="ATimeQuickAdd" name="ATime" class="easyui-timespinner" style="display:none;width:auto"></td>

								<td><label>調派</label></td>
								<td><input id="IsDespQuickAdd" name="IsDesp" class="easyui-textbox" style="display:none;width:auto"></td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td colspan="2" style="vertical-align: top;">
						<table style="width:100%;">
							<tr>
								<td>
									<a class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="insertDetailQuickAdd();">暫添一筆明細</a>
									<table id="DataGridBatchDetailQuickAdd" style="width:100%;height:120px"></table>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td colspan="2" style="vertical-align: top;">
						<table style="width:100%;">
							<tr>
								<td>
									<a class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="insertQuickAdd();">暫添一筆貨物</a>
									<table id="DataGridBatchProdQuickAdd" style="width:100%;height:170px"></table>
								</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</form>
	</div>

	<!--貨物多筆新增-->
	<div id="winBatchNewProd" class="easyui-window" title="新增視窗" style="width:900px;height:500px;display:none"
		 data-options="iconCls:'icon-large-clipart',modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false">
		<a class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="insert();">暫添一筆</a>
		<a class="easyui-linkbutton" iconCls="icon-ok" plain="true" onclick="saveDetail3BatchSubmit();">全部存檔</a>
		<input type="hidden" id="SubCarID" class="easyui-textbox">
		<table id="DataGridBatchProd" style="width:auto;height:420px"></table>
	</div>

	<!--貨物編輯-->
	<div id="winProduct" class="easyui-window" title="貨物" style="width:800px;height:500px;display:none"
		 data-options="iconCls:'icon-large-clipart',modal:true,closed:true,collapsible:false,minimizable:false,maximizable:false">
		<a class="easyui-linkbutton" iconCls="icon-ok" plain="true" onclick="saveDetail3_win();">存檔</a>

		<form id="fm3" method="post" novalidate>
			<table id="table3">
				<tr>
					<td><label>貨物序號</label></td>
					<td>
						<label id="ProdSNoDisplay"></label>
						<input type="hidden" id="ProdShdetNo" name="ShdetNo">
						<input name="sDtlNo" id="sDtlNo" type="hidden">
						<input name="CustNo" id="ProdCustNo" type="hidden">
						<input name="sNo" id="ProdSNo" type="hidden">
					</td>
					<td><label>件數</label></td>
					<td>
						<input name="Pcs" id="Pcs" class="easyui-textbox" style="display:none;width:90px" required="true">
					</td>
				</tr>
				<tr>
					<td colspan="4">
						<label>長</label><input name="fLen" id="fLen" class="easyui-textbox" style="display:none;width:40px">
						<label>寬</label><input name="fWidth" id="fWidth" class="easyui-textbox" style="display:none;width:40px">
						<label>高</label><input name="fHeight" id="fHeight" class="easyui-textbox" style="display:none;width:40px">C.m.
					</td>
				</tr>
				<tr>
					<td><label>總材數</label></td>
					<td>
						<input name="iTotNum" id="iTotNum" class="easyui-numberbox" precision="3" min="0" style="display:none;width:40px" data-options="readonly:false" required="true">材
					</td>
					<td><label>重量</label></td>
					<td><input name="Weig" class="easyui-textbox" style="display:none;width:90px" required="true"><label>KGS</label></td>
				</tr>
				<tr>
					<td><label>內部說明</label></td>
					<td colspan="3"><input name="Remark1" class="easyui-textbox" style="display:none;width:240px" data-options="multiline:'true'"></td>
				</tr>
				<tr>
					<td><label>注意事項</label></td>
					<td colspan="3"><input name="Remark3" class="easyui-textbox" style="display:none;width:240px" data-options="multiline:'true'"></td>
				</tr>
				<tr>
					<td><label>調派狀態</label></td>
					<td>
						<input class="form-check-input" type="checkbox" value="true" name="IsDesp" id="IsDesp" @if (ViewBag.showConfirm != "yes") { @Html.Raw("onclick='return false;'") }>
					</td>
					<td><label>取消狀態</label></td>
					<td>
						<input class="form-check-input" type="checkbox" value="true" name="IsCancel" id="IsCancel" @if (ViewBag.showConfirm != "yes") { @Html.Raw("onclick='return false;'") }>
					</td>
				</tr>
				<tr>
					<td><label>回覆狀態</label></td>
					<td>
						<input class="form-check-input" type="checkbox" value="true" name="IsReply" id="IsReply" @if (ViewBag.showConfirm != "yes") { @Html.Raw("onclick='return false;'") }>
					</td>
					<td><label>完成狀態</label></td>
					<td>
						<input class="form-check-input" type="checkbox" value="true" name="IsFinish" id="IsFinish" @if (ViewBag.showConfirm != "yes") { @Html.Raw("onclick='return false;'") }>
					</td>
				</tr>
				<tr>
					<td><label>回覆說明</label></td>
					<td colspan="3"><input name="ReplyComment" class="easyui-textbox" style="display:none;width:240px" data-options="multiline:'true'"></td>
				</tr>
			</table>
			<div id="step3" data-options="region:'center',title:'調派貨物區',split:false,collapsible:false" style="width:auto;overflow: hidden;">
			</div>
		</form>
	</div>

	<!--電子提單列印-->
	<div id="dlgE_Lading" class="easyui-dialog" style="display:none;width:300px;height:180px;padding:10px 20px"
		 closed="true" buttons="#dlgE_Lading-buttons" data-options="resizable:false,draggable:true">
		<form id="fmE_Lading" method="post" novalidate>
			<table>
				<tr>
					<td style="padding:2px">
						<label>類型：　</label>
					</td>
					<td style="padding:2px">
						<div>
							<select name="E_LadingType" id="E_LadingType" class="easyui-combobox" style="width:auto;display:none" data-options="panelHeight:'auto'">
								<option value="1">電子提單</option>
								<option value="2">電子提單A5</option>
								<option value="3">PML</option>
								<option value="7">BEST</option>
							</select>
						</div>
					</td>
				</tr>
				<tr>
					<td style="padding:2px">
						<label>聯：　</label>
					</td>
					<td style="padding:2px">
						<div>
							<select name="E_LadingColor" id="E_LadingColor" class="easyui-combobox" style="width:auto;display:none" data-options="panelHeight:'auto'">
								<option value="0">　</option>
								<option value="1">簽收聯</option>@*靛*@
								<option value="2">請款聯</option>@*紅*@
								<option value="3">收件聯</option>@*藍*@
							</select>
						</div>
					</td>
				</tr>
			</table>
		</form>
	</div>
	<div id="dlgE_Lading-buttons" style="display:none">
		<a href="javascript:void(0)" class="easyui-linkbutton c6" iconCls="icon-ok" onclick="E_Lading_Print()" style="width:90px">列印</a>
		<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlgE_Lading').dialog('close')" style="width:90px">取消</a>
	</div>

	<!--紙本提單列印-->
	<div id="dlgP_Lading" class="easyui-dialog" style="display:none;width:300px;height:125px;padding:10px 20px"
		 closed="true" buttons="#dlgP_Lading-buttons" data-options="resizable:false,draggable:true">
		<form id="fmP_Lading" method="post" novalidate>
			<table>
				<tr>
					<td style="padding:2px">
						<label>類型：　</label>
					</td>
					<td style="padding:2px">
						<div>
							<select name="P_LadingType" id="P_LadingType" class="easyui-combobox" style="width:auto;display:none" data-options="panelHeight:'auto'">
								<option value="4">PML</option>
								<option value="5">TNT</option>
								<option value="6">EMS</option>
							</select>
						</div>
					</td>
				</tr>
			</table>
		</form>
	</div>
	<div id="dlgP_Lading-buttons" style="display:none">
		<a href="javascript:void(0)" class="easyui-linkbutton c6" iconCls="icon-ok" onclick="P_Lading_Print()" style="width:90px">列印</a>
		<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlgP_Lading').dialog('close')" style="width:90px">取消</a>
	</div>

	<script src="~/Content/easyui/jquery.easyui.min.js"></script>

	<script>
		$(function () {
			$('#LadingNo_TypeQuickAdd').textbox({
				onChange: function (value) {
					if (value.substr(0, 1) == 'P' || value.substr(0, 1) == 'p') {
						$("#LadingNo_TypeQuickAdd").textbox({
							validType: 'length[5,10]'
						});
					} else {
						$("#LadingNo_TypeQuickAdd").textbox({
							validType: 'length[5,15]'
						});
					}
				}
			});
		});
		//將物件與Dataset序列化(Serialize)為JSON
		$.fn.serializeObject = function () {
			var o = {};
			var a = this.serializeArray();
			$.each(a, function () {
				if (o[this.name] !== undefined) {
					if (!o[this.name].push) {
						o[this.name] = [o[this.name]];
					}
					o[this.name].push(this.value || '');
				} else {
					o[this.name] = this.value || '';
				}
			});
			return o;
		};

		function CcNoChange(value, param) {
			if (value != null) {
				if (param == 'tab1')
					$('#tab3CcNo').textbox('setValue', value);
				else
					$('#CcNo').textbox('setValue', value);
			}
		}

		$('#E_LadingType').combobox({
			onChange: function (newValue, oldValue) {
				if (newValue == '3') {
					$('#E_LadingColor').combobox('setValue', '3');
				} else {
					$('#E_LadingColor').combobox('setValue', '0');
				}
			}
		});

		$('#SendCustNo').textbox({
			inputEvents: $.extend({}, $.fn.textbox.defaults.inputEvents, {
				keypress: function (e) {
					if (e.keyCode == 13) {
						if ($('#SendCustNo').val() != '')
							SetCustData();
						else
							$('.SendCustNo').click();
					}
				}
			}),
			rules: $.extend($.fn.validatebox.defaults.rules, {
				maxLength: {
					validator: function (value, param) {
						return param[0] >= value.length;
					},
					message: '最大長度為{0}位.'
				}
			}),
		});

		$('#RecPhone').textbox({
			inputEvents: $.extend({}, $.fn.textbox.defaults.inputEvents, {
				keypress: function (e) {
					if (e.keyCode == 13) {
						if ($('#RecPhone').val()!='')
							SetConsinData();
						else
							$('.RecPhone').click();
					}
				}
			}),
			rules: $.extend($.fn.validatebox.defaults.rules, {
				maxLength: {
					validator: function (value, param) {
						return param[0] >= value.length;
					},
					message: '最大長度為{0}位.'
				}
			}),
		});

		$('#Hsno').textbox({
			inputEvents: $.extend({}, $.fn.textbox.defaults.inputEvents, {
				keypress: function (e) {
					if (e.keyCode == 13) {
						if ($('#Hsno').val() != '')
							SetProductData();
						else
							$('.Hsno').click();
					}
				}
			}),
			rules: $.extend($.fn.validatebox.defaults.rules, {
				maxLength: {
					validator: function (value, param) {
						return param[0] >= value.length;
					},
					message: '最大長度為{0}位.'
				}
			}),
		});

		function lockForm() {
			IsLoadData = true;
			for (var i = 1; i <= 7; i++) {
				$('.dTab'+i+'>span>textarea').attr('readonly', true);
				$('.dTab'+i+'>span>input').attr('readonly', true);
				$('.dTab'+i+'>.easyui-switchbutton.switchbutton-f').switchbutton('readonly');
				$('.dTab'+i+'>a').css('visibility', 'hidden');
				$('.dTab'+i+'>span>a').css('visibility', 'hidden');
				$('.dTab'+i+'>span>span>a').css('visibility', 'hidden');
				$('.dTab'+i+'>span>span>a>a').css('visibility', 'hidden');
				$('.actionTab' + i ).attr('disabled', 'disabled');
			}
		}

		function unlockForm(param, action = "Edit") {
			var selID = $("#grid").jqGrid('getGridParam', 'selrow');
			var selRow = $("#grid").jqGrid('getRowData', selID);
			//解除
			$('.d' + param + '>span>input').attr('readonly', false);
			$('.d' + param + '>span>textarea').attr('readonly', false);
			$('.d' + param + '.easyui-switchbutton.switchbutton-f').switchbutton('readonly', false);
			$('.d' + param + '>a').css('visibility', 'visible');
			$('.d' + param + '>span>span>a').css('visibility', 'visible');
			$('.d' + param + '>span>span>a>a').css('visibility', 'visible');
			$('.action' + param).attr('disabled', false);
			if (param === "Tab1") {
				//將原本readonly欄位 上鎖
				$('#WarehouseRNo').textbox('readonly');
				$('#HubName').textbox('readonly');
				$('#SStatName').textbox('readonly');
				$('#HubName').textbox('readonly');
				$('#CreateBy').textbox('readonly');
				$('#CName').textbox('readonly');
				$('#Type').combobox({
					editable: false
				});
				$('#CocustomTyp').combobox({
					editable: false
				});
				$('#IsInLading').combobox({
					editable: false
				});
				if (action === "Add") {
					var lastSelect = $('#grid').jqGrid("getGridParam", "selrow");
					$("#grid").jqGrid('setRowData', lastSelect, false, {
						opacity: "1",
						"border-bottom": "1px #d7d7d7d7"
					});
					grid.jqGrid("resetSelection");
					$('#showSel').text("");
					$("#grid").jqGrid("resetSelection");
					$('#LadingDate').datebox('setValue', getToday());
					$('#WarehouseRDate').datebox('setValue', getToday());
					$('#SDate').datebox('setValue', getToday());
					$('#SStatNo').val("@ViewBag.StatNo");
					$('#SStatName').textbox('setValue', "@ViewBag.StatName");
					$('#CreateBy').textbox('setValue', "@ViewBag.CreateBy");
					$('#IsInLading').combobox('setValue', 'true');
				} else if (action === "Edit") {
					//已轉會計 不允許修改
					if (selRow.ImOrEx !== "") {
						$.ajax({
							type: "post",
							url: selRow.ImOrEx == "Im" ? '/Import_Bill/' : '/Export_Bill/' + 'GetGridJSON',
							data: { LadingNo: selRow.LadingNo },
							success: function (result) {
								var r = result;
								if (r.rows[0] !== undefined && r.rows[0].IsFinance == true) {
									$('#LadingNo_Type').textbox('readonly');
								}
							}
						});
					}
					$("#Type").combobox('setValue', selRow.Type);
					$("#CocustomTyp").combobox('setValue', selRow.CocustomTyp);
					$('#IsInLading').combobox('setValue', selRow.IsInLading);
				} else if (action === "Copy") {
					$.messager.confirm('確認', '是否複製，' + selRow.LadingNo + "【" + selRow.SendCHName + '】的資料？', function (r) {
						if (r) {
							var lastSelect = $('#grid').jqGrid("getGridParam", "selrow");
							$("#grid").jqGrid('setRowData', lastSelect, false, {
								opacity: "1",
								"border-bottom": "1px #d7d7d7d7"
							});
							grid.jqGrid("resetSelection");
							$('#showSel').text("");
							$('#fmTab3').form('clear');
							$("#dataTab").tabs("select", 0);
							$('#LadingNo').textbox('setValue', '');
							$('#LadingNo_Type').textbox('setValue', '');
							$('#LadingDate').datebox('setValue', getToday());
							$('#WarehouseRDate').datebox('setValue', getToday());
							$('#SDate').datebox('setValue', getToday());
							$("#Type").combobox('setValue', selRow.Type);
							$("#CocustomTyp").combobox('setValue', selRow.CocustomTyp);
						}
					});
				}
			} else if (param === "Tab2") {
				IsLoadData = false;
				$('#IsDesp').attr('readonly', true);
				$('#IsFinish').attr('readonly', true);
				$('#Code7').textbox('readonly');
				$('#CustAddr').textbox('readonly');
				$('#SectorName').textbox('readonly');
				$('#StatNo').textbox('readonly');
				$('#CallStatNo').textbox('readonly');
				$("#tab2_CocustomTyp").combobox('readonly', true)
				if (action == "Add") {
					if (selID != null && selRow.IsDesp === 'false') {
						$('#RedyDate').datebox('setValue', getToday());
						$('#RedyTime').timespinner('setValue', getTodayTime());
						$('#ADate').datebox('setValue', getToday());
						$('#ATime').timespinner('setValue', getTodayTime());
						$('#CallStatNo').textbox("setValue", "@ViewBag.StatNo");
						$('#StatNo').textbox("setValue", "@ViewBag.StatNo");
						$('#tab2_CocustomTyp').combobox('setValue', selRow.CocustomTyp);
						$('#ShdetNo').val(selRow.LadingNo);
						$('#CustNo').val(selRow.SendCustNo);
						$('#tab2_HubNo').val(selRow.HubNo);
						$('#Dest').val(selRow.CName);
						$('#tab2_CcNo').val(selRow.CcNo);
					} else if (selID != null && selRow.IsDesp === 'true') {
						$.messager.alert('警告', '已轉【正式調派】，無法新增資料!', 'warning')
						lockForm();
					} else if (selID == null) {
						$.messager.alert('警告', '無對應單號，無法新增資料!', 'warning')
						lockForm();
					}
				} else {
					if (selRow.IsDesp === 'false') {

					} else {
						$.messager.alert('警告', '已轉【正式調派】，無法編輯資料!', 'warning')
						lockForm();
					}
				}
			} else if (param === "Tab3") {
				$('#Qty').textbox('readonly');
				$('#Weight').textbox('readonly');
				$('#Volume').textbox('readonly');
				if($('#ForIndonesian').val() === null)
					$('#ForIndonesian').combobox('setValue', 'PIBK');
				subgrid3IsView = false;
				Setsubgrid3();
			} else if (param === "Tab6") {
				$('#RecordType').combobox({
					editable: false
				});
				if (action === "Add") {
					$("#RLadingNo").val(selRow.LadingNo);
					$('#RecordDate').datebox('setValue', getToday());
				} else {
					var sub6SelID = $("#subgrid6").jqGrid('getGridParam', 'selrow');
					var sub6Selrow = $("#subgrid6").jqGrid('getRowData', sub6SelID);
					$("#RecordType").combobox('setValue', sub6Selrow.RecordType);
				}
			}
		}

		function Add(param) {
			if (param == 'Tab1') {
				$('.fm').form('clear');
				$('.fm2').form('clear');
				unlockForm('Tab1', 'Add');
				$('#subgrid').jqGrid("setGridParam", {
					url: "/New_Bill_Lading/GetSDJson?LadingNo=★",
					datatype: 'json',
				}).trigger('reloadGrid');
				$('#subgrid2').jqGrid("setGridParam", {
					url: "/New_Bill_Lading/GetSPJSON?ShdetNo=★",
					datatype: 'json',
				}).trigger('reloadGrid');
				$('#subgrid3').jqGrid("setGridParam", {
					url: "/DeclCust_Main/GetGridJson?LadingNo=★",
					datatype: 'json',
				}).trigger('reloadGrid');
				$('#subgrid4').jqGrid("setGridParam", {
					url: "/New_Bill_Lading/GetFileTableJSON?LadingNo=★",
					datatype: 'json',
				}).trigger('reloadGrid');
				$('#subgrid5').jqGrid("setGridParam", {
					url: "/Bill_Lading_View/GetGridJSON2?LadingNo=★",
					datatype: 'json',
				}).trigger('reloadGrid');
				$('#subgrid6').jqGrid("setGridParam", {
					url: "/New_Bill_Lading/GetRecordJSON?LadingNo=★",
					datatype: 'json',
				}).trigger('reloadGrid');
				//$('#subgrid7').jqGrid("setGridParam", {
				//	url: "/New_Bill_Lading/GetTB_temp_Acc1GridJSON?PTNO=★",
				//	datatype: 'json',
				//}).trigger('reloadGrid');
				$('#subgrid8').jqGrid("setGridParam", {
					url: "/New_Bill_Lading/GetSectorMission?sectorNo=★",
					datatype: 'json',
				}).trigger('reloadGrid');
			}
			else if (param == 'Tab2') {
					$('.fm2').form('clear');
					unlockForm('Tab2', 'Add');
			}
			else if (param == 'Tab6') {
				$('.fm3').form('clear');
				unlockForm('Tab6', 'Add');
			}
		}

		function Save(param) {
			var ladingNo = "";
			var sNo = "";
			var selID = $("#grid").jqGrid('getGridParam', 'selrow');
			var subSelID = $("#subgrid").jqGrid('getGridParam', 'selrow');
			var subSelID6 = $("#subgrid6").jqGrid('getGridParam', 'selrow');
			if ($('#fm' + param).form('validate') === false)
				return false;
			//提單儲存
			if (param == 'Tab1' || param == 'Tab3') {
				var list = [];
				var dtldata = $("#subgrid3").jqGrid("getRowData");
				if (dtldata.length > 0) {
					for (var i = 0; i < dtldata.length; i++) {
						if (dtldata[i].BagNo.includes("<input") != true) {
							list.push({
								"sNo": dtldata[i].sNo,
								"LadingNo": dtldata[i].LadingNo,
								"CustType": dtldata[i].CustType,
								"Flight": dtldata[i].Flight,
								"LadNo": dtldata[i].LadNo,
								"BagNo": dtldata[i].BagNo,
								"CleCusCode": dtldata[i].CleCusCode,
								"CusCoode": dtldata[i].CusCoode,
								"ProductNo": dtldata[i].ProductNo,
								"ProductName": dtldata[i].ProductName,
								"ProductEName": dtldata[i].ProductEName,
								"Country": dtldata[i].Country,
								"Type": dtldata[i].Type,
								"HSNo": dtldata[i].HSNo,
								"Qty": dtldata[i].Qty,
								"Unit": dtldata[i].Unit,
								"GrossWeight": dtldata[i].GrossWeight,
								"Weight": dtldata[i].Weight,
								"Price": dtldata[i].Price,
								"Total": dtldata[i].Total,
								"Currency": dtldata[i].Currency,
								"Pcs": dtldata[i].Pcs,
								"PcsNo": dtldata[i].PcsNo,
								"Remark": dtldata[i].Remark,
								"Length": dtldata[i].Length,
								"Width": dtldata[i].Width,
								"Height": dtldata[i].Height,
							});
						}
						else {
							$.messager.alert('警告', '子表第『' + (i + 1) + '』筆資料仍於【編輯狀態】中！<br>請輸入並確認資料正確後，<br>按下【Enter】存取暫存資料。', 'warning');
							return false;
						}
					}
				}
				dtl = JSON.stringify(list);
				$.ajax({
					type: "post",
					url: '/New_Bill_Lading/' + (selID === null ? "AddLading" : "EditLading"),
					data: { data: $(".fm").serializeObject(), dtl: dtl, tab: param },
					beforeSend: function () {
						ajaxLoading('保存中…');
					},
					success: function (result) {
						//var r = eval('(' + result + ')');
						var r = result;
						if (r.ok >= 0) {
							if (r.ok > 0) {
								$("#tab1MsgLabel").html('【提單資料】' + (selID === null ? '新增' : '修改') + '成功!');
								setTimeout(function () { $("#tab1MsgLabel	").html(''); }
									, 3000);
								//$.messager.alert('成功', '【提單資料】' + (selID === null ? '新增' : '修改') + '成功!');
								if ($('#grid').jqGrid('getGridParam', 'selrow') === null)
									ladingNo = r.message.split(":")[1];
								else
									ladingNo = selID;
							}
							else {
								$.messager.alert('警告', r.message, 'warning');
							}

							$('#grid').trigger('reloadGrid');
							doSearchTarget("Sum");
							setTimeout(function () {
								if (selID === null) {
									$('#showSel').text("｜提單號碼：" + ladingNo);
									$("#grid").jqGrid('setSelection', ladingNo);
									$("#dataTab").tabs("select", 0);
									$("#typeTab	").tabs("select", 1);
									unlockForm('Tab2', 'Add');
								} else {
									$('#showSel').text("｜提單號碼：" + ladingNo);
									$("#grid").jqGrid('setSelection', ladingNo);
									$("#dataTab").tabs("select", 0);
								}
							}
								, 1500);
							lockForm();
							ajaxLoadEnd();
						}
						else {
							$.messager.alert('錯誤', r.message, 'error');
							ajaxLoadEnd();
						}
					}
				});
			}
			//調派儲存
			else if (param == 'Tab2') {
				//新增
				if ($('#sNo').val() == '') {
					//$.messager.confirm('確認', '是否取貨（轉正式調派）？', function (r) {
					//$.messager.defaults = { ok: "是", cancel: "否" };
					$.ajax({
						type: "post",
						url: '/New_Bill_Lading/AddShdetDetail',
						data: { data: $(".fm2").serializeObject(), IsDesp: false },
						beforeSend: function () {
							ajaxLoading('保存中…');
						},
						success: function (result) {
							var r = result;
							if (r.ok >= 0) {
								if (r.ok > 0) {
									//$.messager.alert('成功', '【調派明細】新增成功!');
									$("#tab2MsgLabel").html('【調派明細】新增成功! ');
									setTimeout(function () {$("#tab2MsgLabel").html('');}
										, 3000);
									sNo = r.message.split(":")[1];
								}
								else {
									$.messager.alert('警告', r.message, 'warning');
								}
								$('.fm2').form('clear');
								$("#dataTab").tabs("select", 1);
								$('#subgrid').trigger('reloadGrid');
								setTimeout(function () {
									$('#subgrid').jqGrid('setSelection', sNo);
									newBatchDetail3()
									setTimeout(function () {insert();}, 1500);
								}
									, 1500);
								lockForm();
								ajaxLoadEnd();
							}
							else {
								$.messager.alert('錯誤', r.message, 'error');
								ajaxLoadEnd();
							}
						}
						//});
					});
				}
				//編輯
				else {
					$.ajax({
						type: "post",
						url: '/New_Bill_Lading/EditShdetDetail',
						data: { data: $(".fm2").serializeObject() },
						beforeSend: function () {
							ajaxLoading('保存中…');
						},
						success: function (result) {
							//var r = eval('(' + result + ')');
							var r = result;
							if (r.ok >= 0) {
								if (r.ok > 0) {
									//$.messager.alert('成功', '【調派明細】修改成功!');
									$("#tab2MsgLabel").html('【調派明細】修改成功! ');
									setTimeout(function () { $("#tab2MsgLabel").html(''); }
										, 3000);
								}
								else {
									$.messager.alert('警告', r.message, 'warning');
								}
								$('.fm2').form('clear');
								$("#dataTab").tabs("select", 1);
								$('#subgrid').trigger('reloadGrid');
								setTimeout(function () { $('#subgrid').jqGrid('setSelection', subSelID); }
									, 1500);
								lockForm();
								ajaxLoadEnd();
							}
							else {
								$.messager.alert('錯誤', r.message, 'error');
								ajaxLoadEnd();
							}
						}
					});
				}
			}
			//來往紀錄儲存
			else if (param == 'Tab6') {
				//新增
				if ($('#SNo').val() == '') {
					$.ajax({
						type: "post",
						url: '/New_Bill_Lading/AddRecord',
						data: { data: $(".fm3").serializeObject() },
						beforeSend: function () {
							ajaxLoading('保存中…');
						},
						success: function (result) {
							var r = result;
							if (r.ok >= 0) {
								if (r.ok > 0) {
									$.messager.alert('成功', '【來往紀錄】新增成功!');
									SNo = r.message.split(":")[1];
								}
								else {
									$.messager.alert('警告', r.message, 'warning');
								}
								$('.fm3').form('clear');
								$('#subgrid6').trigger('reloadGrid');
								setTimeout(function () { $('#subgrid6').jqGrid('setSelection', SNo); }
									, 1500);
								lockForm();
								ajaxLoadEnd();
							}
							else {
								$.messager.alert('錯誤', r.message, 'error');
								ajaxLoadEnd();
							}
						}
					});
				}
				//編輯
				else {
					$.ajax({
						type: "post",
						url: '/New_Bill_Lading/EditRecord',
						data: { data: $(".fm3").serializeObject() },
						beforeSend: function () {
							ajaxLoading('保存中…');
						},
						success: function (result) {
							//var r = eval('(' + result + ')');
							var r = result;
							if (r.ok >= 0) {
								if (r.ok > 0) {
									$.messager.alert('成功', '【來往紀錄】修改成功!');
								}
								else {
									$.messager.alert('警告', r.message, 'warning');
								}
								$('.fm3').form('clear');
								$('#subgrid6').trigger('reloadGrid');
								setTimeout(function () { $('#subgrid6').jqGrid('setSelection', subSelID6); }
									, 1500);
								lockForm();
								ajaxLoadEnd();
							}
							else {
								$.messager.alert('錯誤', r.message, 'error');
								ajaxLoadEnd();
							}
						}
					});
				}
			}
		}

		function Delete(param) {
			var selID = $("#grid").jqGrid('getGridParam', 'selrow');
			var selRow = $("#grid").jqGrid('getRowData', selID);
			if (param == 'Tab1') {
				$.messager.confirm('Confirm', '是否刪除此筆資料？', function (r) {
					if (r) {
						$.ajax({
							type: "post",
							url: '/New_Bill_Lading/DeleteLading',
							data: { data: $(".fm").serializeObject() },
							success: function (result) {
								//var r = eval('(' + result + ')');
								var r = result;
								if (r.ok >= 0) {
									if (r.ok > 0) {
										$.messager.alert('成功', '刪除成功!');
									}
									else {
										$.messager.alert('警告', r.message, 'warning');
									}
									$('.fm').form('clear');
									$('.fm2').form('clear');
									$('.fm3').form('clear');
									$('#grid').trigger('reloadGrid');
									$('#subgrid').trigger('reloadGrid');
									$('#subgrid2').trigger('reloadGrid');
									$('#subgrid3').jqGrid("setGridParam", {
										url: "/DeclCust_Main/GetGridJson?LadingNo=★",
										datatype: 'json',
									}).trigger('reloadGrid');
									$('#subgrid4').jqGrid("setGridParam", {
										url: "/New_Bill_Lading/GetFileTableJSON?LadingNo=★",
										datatype: 'json',
									}).trigger('reloadGrid');
									$('#subgrid5').jqGrid("setGridParam", {
										url: "/Bill_Lading_View/GetGridJSON2?LadingNo=★",
										datatype: 'json',
									}).trigger('reloadGrid');
									$('#subgrid6').jqGrid("setGridParam", {
										url: "/New_Bill_Lading/GetRecordJSON?LadingNo=★",
										datatype: 'json',
									}).trigger('reloadGrid');
									$('#subgrid8').jqGrid("setGridParam", {
										url: "/New_Bill_Lading/GetSectorMission?sectorNo=★",
										datatype: 'json',
									}).trigger('reloadGrid');
									lockForm();
								}
								else {
									$.messager.alert('錯誤', r.message, 'error');
								}
							}
						});
					}
				});
			}
			else if (param == 'Tab2') {
				if (selRow.IsDesp === 'false') {
					$.messager.confirm('Confirm', '是否刪除此筆資料？', function (r) {
						if (r) {
							$.ajax({
								type: "post",
								url: '/New_Bill_Lading/DeleteShdetDetail',
								data: { data: $(".fm2").serializeObject() },
								success: function (result) {
									//var r = eval('(' + result + ')');
									var r = result;
									if (r.ok >= 0) {
										if (r.ok > 0) {
											$.messager.alert('成功', '刪除成功!');
										}
										else {
											$.messager.alert('警告', r.message, 'warning');
										}
										$('.fm2').form('clear');
										$('#subgrid').trigger('reloadGrid');
										$('#subgrid2').jqGrid("setGridParam", {
											url: "/New_Bill_Lading/GetSPJSON?ShdetNo=★",
											datatype: 'json',
										}).trigger('reloadGrid');
										$('#subgrid8').jqGrid("setGridParam", {
											url: "/New_Bill_Lading/GetSectorMission?sectorNo=★",
											datatype: 'json',
										}).trigger('reloadGrid');
										lockForm();
									}
									else {
										$.messager.alert('錯誤', r.message, 'error');
									}
								}
							});
						}
					});
				}
				else {
					$.messager.alert('警告', '已轉【正式調派】，無法刪除資料!', 'warning')
					lockForm();
				}
			}
			else if (param == 'Tab6') {
				$.messager.confirm('Confirm', '是否刪除此筆資料？', function (r) {
					if (r) {
						$.ajax({
							type: "post",
							url: '/New_Bill_Lading/DeleteRecord',
							data: { data: $(".fm3").serializeObject() },
							success: function (result) {
								//var r = eval('(' + result + ')');
								var r = result;
								if (r.ok >= 0) {
									if (r.ok > 0) {
										$.messager.alert('成功', '刪除成功!');
									}
									else {
										$.messager.alert('警告', r.message, 'warning');
									}
									$('.fm3').form('clear');
									$('#subgrid6').trigger('reloadGrid');
									lockForm();
								}
								else {
									$.messager.alert('錯誤', r.message, 'error');
								}
							}
						});
					}
				});
			}
		}

		function AddCust() {
			if ($('#SendCustNo').val() != "") {
              $.getJSON('/Cust/GetGridJSON2/?CustNo=' + $('#SendCustNo').val(), function (data) {
				  if (data.records > 0) {
					$('#dlgCust').dialog('open').dialog('setTitle', '客戶明細新增');
					$('#dlgCust').form('clear');
					$('#dcuCustNo').textbox('setValue',$('#SendCustNo').val())
					$('#IsServer').switchbutton('check');
				}
				else
					$.messager.alert('錯誤', '查無此【客戶編號】。');
			})
            } else {
                $.messager.alert('警告', '尚未輸入【客戶編號】!', 'warning');
            }
		}

		function SaveCust() {
            $('#fmCust').form('submit', {
				url: '/Cust/AddCustDetail',
                onSubmit: function () {
                    return $(this).form('validate');
                },
                success: function (result) {
                    var r = eval('(' + result + ')');
                    if (r.ok >= 0) {
                        if (r.ok > 0) {
                            $.messager.alert('成功', '客戶明細存檔成功!');
                        }
                        else {
                            $.messager.alert('警告', r.message, 'warning');
                        }
                        $('#dlgCust').dialog('close');
                    }
                    else {
                        $.messager.alert('錯誤', r.message, 'error');
                    }
                }
            });
		}

		function SetCustData() {
			$.getJSON('/Cust/GetGridJSON2/?CustNo=' + $('#SendCustNo').val(), function (data) {
				if (data.records > 0) {
					var no = data.records - 1;
					$('#SendCustNo').textbox('setValue', data.rows[no].CustNo);
					$('#SendCHName').textbox('setValue', data.rows[no].CustCHName);
					$('#SendCustLevel').textbox('setValue', data.rows[no].CustLevel);
					$('#SendPhone').textbox('setValue', data.rows[no].Phone);
					$('#SendBy').textbox('setValue', data.rows[no].SendBy);
					$('#SendCompany').textbox('setValue', data.rows[no].CustCName);
					$('#SendInvNo').textbox('setValue', data.rows[no].InvNo);
					$('#SendCustAddr').textbox('setValue', data.rows[no].CustAddrFull);
					$('#SendCity').textbox('setValue', data.rows[no].City);
					$('#SendCountry').textbox('setValue', data.rows[no].Country);
					$('#SendState').textbox('setValue', data.rows[no].State);
					$('#SendPostDist').textbox('setValue', data.rows[no].PostDist);
					$('#SendEBy').textbox('setValue', data.rows[no].ESendBy);
					$('#SendECompany').textbox('setValue', data.rows[no].CustEName);
					$('#SendEInvNo').textbox('setValue', data.rows[no].EInvNo);
					$('#SendECustAddr').textbox('setValue', data.rows[no].CustENAddr1);
					$('#SendECity').textbox('setValue', data.rows[no].ECity);
					$('#SendECountry').textbox('setValue', data.rows[no].ECountry);
					$('#SendEState').textbox('setValue', data.rows[no].EState);
					$('#SendEPostDist').textbox('setValue', data.rows[no].EPostDist);
				}
				else
					$.messager.alert('錯誤', '查無此【客戶編號】。');
			})
		}

		function AddConsin() {
			if ($('#SendCustNo').val() == "")
				$.messager.alert('錯誤', '請先輸入【客戶編號】。');
			else {
				$('#dlgConsin').dialog('open').dialog('setTitle', '收件人新增');
				$('#fmConsin').form('clear');
				$('#dcoTel').textbox('setValue', $('#RecPhone').val());
				$('#dcoMPhone').textbox('setValue', $('#RecMPhone').val());
				$('#dcoConsinee').textbox('setValue', $('#RecBy').val());
				$('#dcoConsinComp').textbox('setValue', $('#RecCompany').val());
				$('#dcoCnaddr').textbox('setValue', $('#RecChAddr').val());
				$('#dcoUnifyNo').textbox('setValue', $('#RecInvNo').val());
				$('#dcoState').textbox('setValue', $('#RecState').val());
				$('#dcoCountry').textbox('setValue', $('#RecCountry').val());
				$('#dcoZip').textbox('setValue', $('#RecPostDist').val());
				$('#dcoCity').textbox('setValue', $('#RecCity').val());

				$('#dcoCustCName').textbox('setValue', $('#SendCHName').val());
				$('#dcoCustNo').val($('#SendCustNo').val());
				$('#dcoCustCName').textbox('setValue', $('#SendCHName').val());

				$('#IsServer').switchbutton('check');
			}
		}

		function SaveConsin() {
			$('#fmConsin').form('submit', {
				url:'/Consin/Add',
				onSubmit: function () {
					return $(this).form('validate');
				},
				success: function (result) {
					var r = eval('(' + result + ')');
					if (r.ok >= 0) {
						if (r.ok > 0) {
							$.messager.alert('成功', '收件人存檔成功!');
						}
						else {
							$.messager.alert('警告', r.message, 'warning');
						}
						$('#dlgConsin').dialog('close');
					}
					else {
						$.messager.alert('錯誤', r.message, 'error');
					}
				}
			});
        }

		function SetConsinData() {
			$.getJSON('/Consin/GetGridJSON/?Phone=' + $('#RecPhone').val(), function (data) {
				if (data.records > 0) {
					$('#RecBy').textbox('setValue', data.rows[0].Consinee);
					$('#RecPhone').textbox('setValue', data.rows[0.].Tel);
					$('#RecMPhone').textbox('setValue', data.rows[0.].MPhone);
					$('#RecCompany').textbox('setValue', data.rows[0].ConsinComp);
					$('#RecInvNo').textbox('setValue', data.rows[0].UnifyNo);
					$('#RecChAddr').textbox('setValue', data.rows[0].Cnaddr);
					$('#RecCity').textbox('setValue', data.rows[0].City);
					$('#RecCountry').textbox('setValue', data.rows[0].Country);
					$('#RecState').textbox('setValue', data.rows[0].State);
					$('#RecPostDist').textbox('setValue', data.rows[0].Zip);
				}
				else
					$.messager.alert('錯誤', '查無此【收件電話】。');
			})
		}

		function SetProductData () {
			$.getJSON('/Product/GetGridJSON/?Hsno=' + $('#Hsno').val(), function (data) {
				if (data.records > 0) {
					$('#Hsno').textbox('setValue', data.rows[0].Hsno);
					$('#ProductNo').val( data.rows[0.].ProductNo);
					$('#ProductName').textbox('setValue', data.rows[0].ProductName);
				}
				else
					$.messager.alert('錯誤', '查無此【HS Code】。');
			})
		}

		function SetDesp() {
			var selID = $('#grid').jqGrid('getGridParam', 'selrow');
			var selrow = $("#grid").jqGrid('getRowData', selID);
			$.messager.confirm('確認', '是否取貨（轉正式調派）？', function (r) {
				if (r) {
					$.ajax({
						type: "post",
						url: '/New_Bill_Lading/SetDesp',
						data: {ShdetNo: selrow.ShdetNo },
						success: function (result) {
							//var r = eval('(' + result + ')');
							var r = result;
							if (r.ok >= 0) {
								if (r.ok > 0) {
									//$.messager.alert('成功', '轉正式調派成功!');
									$("#tab2MsgLabel").html('轉正式調派成功 ');
									setTimeout(function () { $("#tab2MsgLabel").html(''); }
										, 3000);
								}
								else {
									$.messager.alert('警告', r.message, 'warning');
								}
								$('.fm2').form('clear');
								$('#grid').trigger('reloadGrid');
								$('#grid').jqGrid('setSelection', selID);
								lockForm();
							}
							else {
								$.messager.alert('錯誤', r.message, 'error');
							}
						}
					});
				}
			});
		}

		function ajaxLoading(param) {
			$("<div class=\"datagrid-mask\"></div>").css({ display: "block", width: "100%", height: $(window).height() }).appendTo("body");
			$("<div class=\"datagrid-mask-msg\"  style = 'width: 120px;height:45px'></div>").html(param).appendTo("body").css({ display: "block", left: ($(document.body).outerWidth(true) - 190) / 2, top: ($(window).height() - 30) / 2 });

		}

		function ajaxLoadEnd() {
			$(".datagrid-mask").remove();
			$(".datagrid-mask-msg").remove();
		}

		function getToday() {
			var today = new Date();
			return today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
		}

		function getTodayTime() {

			var today = new Date();
			return today.getHours() + ':' + today.getMinutes() + ':' + today.getMinutes();
		}

		function getTodayDateTime() {

			var today = new Date();
			return today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate() + ' ' + today.getHours() + ':' + today.getMinutes();
		}

		function getBeforeSevenDays() {
			var today = new Date();
			var sevendays = new Date(today.getTime() - (7 * 24 * 60 * 60 * 1000));
			return sevendays.getFullYear() + '-' + (sevendays.getMonth() + 1) + '-' + sevendays.getDate();
		}

		function Search() {
			$('#dlgSearch').dialog('open').dialog('setTitle', '查詢');
			//$('#dlgSearch').form('clear');
			$('#searchDateStart').val() == "" ? $('#searchDateStart').datebox('setValue', getToday()) : $('#searchDateStart').datebox('setValue', $('#searchDateStart').val());
			$('#searchDateEnd').val() == "" ? $('#searchDateEnd').datebox('setValue', getToday()) : $('#searchDateEnd').datebox('setValue', $('#searchDateEnd').val());
			$.ajax({
				url: '/User/GetGridJSON?rows=1000',
				type: 'post',
				success: function (result) {
					$('#s_User').combobox({
						data: result.rows,
						valueField: 'Account',
						textField: 'UserName',
					});
				}
			})
		}

		function doSearchTarget(param = "All") {
			if (param == "All") {
				$('.fm1').form('clear');
				$('.fm2').form('clear');
				$('.fm3').form('clear');
				lockForm();
				$.ajax({
					type: "post",
					url: '/New_Bill_Lading/' + "GetSearchSumJson?" +
						"LadingNo_Type=" + $('#s_LadingNo_Type').textbox('getValue') +
						"&start_date=" + $('#searchDateStart').datebox('getValue') +
						"&end_date=" + $('#searchDateEnd').datebox('getValue') +
						"&HubNo=" + $('#s_HubNo').val() +
						"&S_SectorNo=" + $('#s_SectorNo').val() +
						"&SendCustNo=" + $('#s_SendCustNo').textbox('getValue') +
						"&SendPhone=" + $('#s_SendPhone').textbox('getValue') +
						"&SendInvNo=" + $('#s_SendInvNo').textbox('getValue') +
						"&SendCompany=" + $('#s_SendCompany').textbox('getValue') +
						"&RecCompany=" + $('#s_RecCompany').textbox('getValue') +
						"&RecPhone=" + $('#s_RecPhone').textbox('getValue') +
						"&SStatNo=" + $('#s_SStatNo').val() +
						"&AStatNo=" + $('#s_AStatNo').val() +
						"&PickUpAreaNo=" + $('#s_PickUpAreaNo').textbox('getValue') +
						"&CocustomTyp=" + $('#s_CocustomTyp').val() +
						"&IsFinish=" + $('#s_IsFinish').val() +
						"&RecordType=" + $('#s_RecordType').val() +
						"&CreateBy=" + $('#s_User').val() +
						"&IsDesp=" + $('#s_IsDesp').textbox('getValue'),
					success: function (result) {
						$('#fmTotalbar').form('load', result.rows);
					}
				});
				grid.jqGrid("setGridParam", {
					url: apiURL + "GetSearchGridJson?" +
						"LadingNo_Type=" + $('#s_LadingNo_Type').textbox('getValue') +
						"&start_date=" + $('#searchDateStart').datebox('getValue') +
						"&end_date=" + $('#searchDateEnd').datebox('getValue') +
						"&HubNo=" + $('#s_HubNo').val() +
						"&S_SectorNo=" + $('#s_SectorNo').val() +
						"&SendCustNo=" + $('#s_SendCustNo').textbox('getValue') +
						"&SendPhone=" + $('#s_SendPhone').textbox('getValue') +
						"&SendInvNo=" + $('#s_SendInvNo').textbox('getValue') +
						"&SendCompany=" + $('#s_SendCompany').textbox('getValue') +
						"&RecCompany=" + $('#s_RecCompany').textbox('getValue') +
						"&RecPhone=" + $('#s_RecPhone').textbox('getValue') +
						"&SStatNo=" + $('#s_SStatNo').val() +
						"&AStatNo=" + $('#s_AStatNo').val() +
						"&PickUpAreaNo=" + $('#s_PickUpAreaNo').textbox('getValue') +
						"&CocustomTyp=" + $('#s_CocustomTyp').val() +
						"&IsFinish=" + $('#s_IsFinish').val() +
						"&RecordType=" + $('#s_RecordType').val() +
						"&CreateBy=" + $('#s_User').val() +
						"&IsDesp=" + $('#s_IsDesp').textbox('getValue'),
					datatype: 'json'
				}).trigger('reloadGrid');
				$('#subgrid').jqGrid("setGridParam", {
					url: "/New_Bill_Lading/GetSDJson?LadingNo=★",
					datatype: 'json',
				}).trigger('reloadGrid');
				$('#subgrid2').jqGrid("setGridParam", {
					url: "/New_Bill_Lading/GetSPJSON?ShdetNo=★",
					datatype: 'json',
				}).trigger('reloadGrid');
				$('#subgrid3').jqGrid("setGridParam", {
					url: "/DeclCust_Main/GetGridJson?LadingNo=★",
					datatype: 'json',
				}).trigger('reloadGrid');
				$('#subgrid4').jqGrid("setGridParam", {
					url: "/New_Bill_Lading/GetFileTableJSON?LadingNo=★",
					datatype: 'json',
				}).trigger('reloadGrid');
				$('#subgrid5').jqGrid("setGridParam", {
					url: "/Bill_Lading_View/GetGridJSON2?LadingNo=★",
					datatype: 'json',
				}).trigger('reloadGrid');
				$('#subgrid6').jqGrid("setGridParam", {
					url: "/New_Bill_Lading/GetRecordJSON?LadingNo=★",
					datatype: 'json',
				}).trigger('reloadGrid');
				//$('#subgrid7').jqGrid("setGridParam", {
				//	url: "/New_Bill_Lading/GetTB_temp_Acc1GridJSON?PTNO=★",
				//	datatype: 'json',
				//}).trigger('reloadGrid');
				$('#subgrid8').jqGrid("setGridParam", {
					url: "/New_Bill_Lading/GetSectorMission?sectorNo=★",
					datatype: 'json',
				}).trigger('reloadGrid');
				$('#dlgSearch').dialog('close');
			}
			else if (param == "Sum") {
				$.ajax({
					type: "post",
					url: '/New_Bill_Lading/' + "GetSearchSumJson?" +
						"LadingNo_Type=" + $('#s_LadingNo_Type').textbox('getValue') +
						"&start_date=" + $('#searchDateStart').datebox('getValue') +
						"&end_date=" + $('#searchDateEnd').datebox('getValue') +
						"&HubNo=" + $('#s_HubNo').val() +
						"&S_SectorNo=" + $('#s_SectorNo').val() +
						"&SendCustNo=" + $('#s_SendCustNo').textbox('getValue') +
						"&SendPhone=" + $('#s_SendPhone').textbox('getValue') +
						"&SendInvNo=" + $('#s_SendInvNo').textbox('getValue') +
						"&SStatNo=" + $('#s_SStatNo').val() +
						"&AStatNo=" + $('#s_AStatNo').val() +
						"&PickUpAreaNo=" + $('#s_PickUpAreaNo').textbox('getValue') +
						"&CocustomTyp=" + $('#s_CocustomTyp').val() +
						"&IsFinish=" + $('#s_IsFinish').val() +
						"&RecordType=" + $('#s_RecordType').val() +
						"&CreateBy=" + $('#s_User').val() +
						"&IsDesp=" + $('#s_IsDesp').textbox('getValue'),
					success: function (result) {
						$('#fmTotalbar').form('load', result.rows);
					}
				});
			}
		}

		function dlgClear() {
			$('#dlgSearch').form('clear');
			$('#searchDateStart').datebox('setValue', getToday());
			 $('#searchDateEnd').datebox('setValue', getToday());
		}

		function ShowWinForPickUpjqGrid2(formId, inputFields, inputValues, contentUrl) {
			$('#win').window('open');
			$('#win').panel('clear');
			$('#win').window('setTitle', '');
			$('#win').window('refresh', contentUrl + '?' + 'formId=' + formId + '&inputFields=' + inputFields + '&inputValues=' + inputValues);
		}

		function ShowWinForPickUpjqGrid(formId, inputFields, inputValues, contentUrl, id = null, funcName = "GetGridJSON") {
			$('#win').window('open');
			$('#win').panel('clear');
			$('#win').window('setTitle', '');
			$('#win').window('refresh', contentUrl + '?' + 'formId=' + formId + '&inputFields=' + inputFields + '&inputValues=' + inputValues + '&id=' + id + '&funcName=' + funcName);
		}

		function ShowWinForPickUpGrid(retID1, retVal1, retType1, retID2, retVal2, retType2, titleString, contentUrl) {
			$('#win').window('open');
			$('#win').panel('clear');
			$('#win').window('setTitle', titleString);
			$('#win').window('refresh', contentUrl + '?retID1=' + retID1 + '&retVal1=' + retVal1 + '&retType1=' + retType1 + '&retID2=' + retID2 + '&retVal2=' + retVal2 + '&retType2=' + retType2);
		}

		function ShowWinForPickUpGridMulti(retID1, retVal1, retType1, retID2, retVal2, retType2, titleString, contentUrl) {
			$('#win').window('open');
			$('#win').panel('clear');
			$('#win').window('setTitle', titleString);
			$('#win').window('refresh', contentUrl + '?retID1=' + retID1 + '&retVal1=' + retVal1 + '&retType1=' + retType1 + '&retID2=' + retID2 + '&retVal2=' + retVal2 + '&retType2=' + retType2 + '&multiCheck=yes');
		}

		function ShowWinForPickUpGrid20(retID1, retVal1, retType1, retID2, retVal2, retType2, retID3, retVal3, retType3, retID4, retVal4, retType4, retID5, retVal5, retType5, retID6, retVal6, retType6, retID7, retVal7, retType7, retID8, retVal8, retType8, retID9, retVal9, retType9, retID10, retVal10, retType10, retID11, retVal11, retType11, retID12, retVal12, retType12, retID13, retVal13, retType13, retID14, retVal14, retType14, retID15, retVal15, retType15, retID16, retVal16, retType16, retID17, retVal17, retType17, retID18, retVal18, retType18, retID19, retVal19, retType19, retID20, retVal20, retType20, titleString, contentUrl, target)
		{
			$('#win').window('open');
			$('#win').panel('clear');
			$('#win').window('setTitle', titleString);
			$('#win').window('refresh', contentUrl + '?retID1=' + retID1 + '&retVal1=' + retVal1 + '&retType1=' + retType1 + '&retID2=' + retID2 + '&retVal2=' + retVal2 + '&retType2=' + retType2 + '&retID3=' + retID3 + '&retVal3=' + retVal3 + '&retType3=' + retType3 + '&retID4=' + retID4 + '&retVal4=' + retVal4 + '&retType4=' + retType4 + '&retID5=' + retID5 + '&retVal5=' + retVal5 + '&retType5=' + retType5 + '&retID6=' + retID6 + '&retVal6=' + retVal6 + '&retType6=' + retType6 + '&retID7=' + retID7 + '&retVal7=' + retVal7 + '&retType7=' + retType7 + '&retID8=' + retID8 + '&retVal8=' + retVal8 + '&retType8=' + retType8 + '&retID9=' + retID9 + '&retVal9=' + retVal9 + '&retType9=' + retType9 + '&retID10=' + retID10 + '&retVal10=' + retVal10 + '&retType10=' + retType10 + '&retID11=' + retID11 + '&retVal11=' + retVal11 + '&retType11=' + retType11 + '&retID12=' + retID12 + '&retVal12=' + retVal12 + '&retType12=' + retType12 + '&retID13=' + retID13 + '&retVal13=' + retVal13 + '&retType13=' + retType13 + '&retID14=' + retID14 + '&retVal14=' + retVal14 + '&retType14=' + retType14 + '&retID15=' + retID15 + '&retVal15=' + retVal15 + '&retType15=' + retType15 + '&retID16=' + retID16 + '&retVal16=' + retVal16 + '&retType16=' + retType16 + '&retID17=' + retID17 + '&retVal17=' + retVal17 + '&retType17=' + retType17 + '&retID18=' + retID18 + '&retVal18=' + retVal18 + '&retType18=' + retType18 + '&retID19=' + retID19 + '&retVal19=' + retVal19 + '&retType19=' + retType19 + '&retID20=' + retID20 + '&retVal20=' + retVal20 + '&retType20=' + retType20 + '&target=' + target);
		}
	</script>

</body>
</html>



